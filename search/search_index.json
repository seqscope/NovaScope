{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to NovaScope documentation","text":""},{"location":"#introduction","title":"Introduction","text":"<p>NovaScope is a Snakemake-based pipeline that processes spatial transcriptomics data generated from the Seq-Scope. Currently, it is tailored to process the spatial arrays generated from the Illumina NovaSeq 6000 platform. The preprint for NovaScope is available at DOI: 10.1101/2024.03.29.587285.</p>"},{"location":"#functionality","title":"Functionality","text":"<p>The main purpose of NovaScope is to process raw sequencing data (1st-seq and 2nd-seq), align reads to the reference genome, and produce spatial gene expression at the submicron resolution. </p> <p>It provides additional functionalities for accurate histological images alignment with transcriptome dataset, conversion of spatial gene expression data for compatibility with FICTURE, and the organization of pixels into customizable hexagonal grids. </p> <p>It features a modular and adaptable design, enabling users to tailor the pipeline according to their particular requirements.</p>"},{"location":"#infrastructure","title":"Infrastructure","text":"<p>This pipeline is built to operate on Unix-based high-performance computing (HPC) platforms, with the capability to run either directly on local systems or via the Slurm workload manager.</p>"},{"location":"#overview","title":"Overview","text":"<p>NovaScope primarily consists of two steps as shown in the figure below.</p> <p>Figure 1: Overview of the NovaScope pipeline: Step 1 processes the 1st-seq FASTQ files to generate spatial barcode maps for each \"Chip\", a 10x6 array of tiles. Step 2 processes the 2nd-seq FASTQ files, aligns reads to the reference genome, and produces spatial gene expression at submicron resolution.  </p>"},{"location":"getting_started/access_data/","title":"Accessing Example Datasets","text":""},{"location":"getting_started/access_data/#dataset-overview","title":"Dataset Overview","text":"<p>There are three example datasets published with the NovaScope protocol. Each input dataset contains two types of FASTQ files: (a) 1st-seq (single-end) FASTQ file that contains spatial barcodes to construct a barcode map, and (b) 2nd-seq (paired-end) FASTQ files that contains spatial barcodes in Read 1, and cDNA sequences in Read 2. </p>"},{"location":"getting_started/access_data/#minimal-test-run-dataset","title":"Minimal Test Run Dataset","text":"<p>This is a small (1.14GB) test run dataset comprising of a subset of the (shallow) liver section data described in Shallow Liver Section Dataset. This dataset is meant to be used to test the sanity of the pipeline, without necessarily offering biologically meaningful interpretation of data. </p>"},{"location":"getting_started/access_data/#shallow-liver-section-dataset","title":"Shallow Liver Section Dataset","text":"<p>This dataset is a typical (23.7GB) example of Seq-Scope dataset that can be initially generated for a tissue section. Typically, the 2nd-seq FASTQ files contain 150-200M paired-end reads. This should be sufficient to examine the spatial distribution of the transcripts across the tissue, assess the quality of dataset, identify major cell types and marker genes, and perform basic pixel-level decoding of the spatial transcriptome. If the quality of the initial dataset look great, one may decide to sequence the library much more deeply to maximize the information content. (see Deep Liver Section Dataset for more details)</p>"},{"location":"getting_started/access_data/#deep-liver-section-dataset","title":"Deep Liver Section Dataset","text":"<p>If the initial examination of the shallow dataset looks promising, one can sequence the library much more deeply, to the level of saturating the library. A deeply sequenced dataset typically contains multiple pairs of FASTQ files, possibly across multiple sequencing runs. The deeply sequenced liver section dataset, available at https://doi.org/10.7302/tw62-4f97, has 7 pairs of FASTQ files (250GB) in addition to the shallow dataset.</p>"},{"location":"getting_started/access_data/#downloading-the-datasets","title":"Downloading the Datasets","text":"<p>Each of the three datasets have their own DOIs, which can be accessed using the URLs below.</p> <ul> <li>Minimal Test Run Dataset (1.14GB) : https://doi.org/10.5281/zenodo.10835761</li> </ul> <pre><code>## To download the tarball from Zenodo, you can use the following command\nwget \"https://zenodo.org/records/10835761/files/B08Csub_20240318_raw.tar.gz\"\n\n## uncompress the tarball using the following command:\nmkdir B08Ctest\ncd B08Ctest\ntar xzvf ../B08Csub_20240318_raw.tar.gz\n</code></pre> <ul> <li>Shallow Liver Section Dataset (23.7GB) : https://doi.org/10.5281/zenodo.10840696 </li> </ul> <pre><code>## To download the tarball from Zenodo, you can use the following command\n\n## create a directory to store the data\nmkdir B08Cshallow\ncd B08Cshallow\n\n## download the 1st-seq FASTQ file\nwget \"https://zenodo.org/records/10840696/files/9203-AP.L3.B08C.R1_001.fastq.gz\"\n\n## download the 2nd-seq FASTQ files (R1 and R2)\nwget \"https://zenodo.org/records/10840696/files/9748-YK-3_CGAGGCTG_S3_R1_001.fastq.gz\"\nwget \"https://zenodo.org/records/10840696/files/9748-YK-3_CGAGGCTG_S3_R2_001.fastq.gz\"\n\n## Additionally, you may want to download md5sum files \n## to verify the integrity of the downloaded files\n</code></pre> <ul> <li>Deep Liver Section Dataset (250GB) : Link to Deep Blue Data <ul> <li>Note that you need to use Globus to download the dataset.</li> <li>Note that this dataset contains only additional 2nd-seq FASTQ files in addition to the Shallow Liver Section Dataset, so you need to download the shallow dataset first. </li> </ul> </li> </ul>"},{"location":"getting_started/execute/","title":"Executing the NovaScope Pipeline","text":""},{"location":"getting_started/execute/#preliminary-steps","title":"Preliminary Steps","text":"<p>Tip</p> <p>Before running the full pipeline, performing a sanity check by executing a dry run is highly recommended. A dry run verifies that your <code>config_job.yaml</code> is properly configured and outlines the necessary jobs to be executed.</p> <p>Tip</p> <p>Additionally, you can create a rule graph that visually represents the structure of the workflow or a Directed Acyclic Graph (DAG) to view all jobs and their actual dependency structure.</p> <p>Below provides commands for a dry-run and visualization. <pre><code># paths\nsmk_dir=/path/to/the/novascope/repository\njob_dir=/path/to/the/job/directory              # The job directory should has the `config_job.yaml` file.\n\n## (recommended) start with a dry run\n## - view all information:\nsnakemake -s $smk_dir/NovaScope.smk --rerun-incomplete -d $job_dir --dry-run -p\n\n## - simply summarize the jobs to be executed without other information:\nsnakemake -s $smk_dir/NovaScope.smk --rerun-incomplete -d $job_dir --dry-run --quiet\n\n## (optional) visualization:\n## - (1) rulegraph\nsnakemake --rulegraph  -s $smk_dir/NovaScope.smk --rerun-incomplete -d $job_dir | dot -Tpdf &gt; rulegraph.pdf\n\n## - (2) DAG\nsnakemake --dag  -s $smk_dir/NovaScope.smk --rerun-incomplete -d $job_dir | dot -Tpdf &gt; dag.pdf\n</code></pre></p>"},{"location":"getting_started/execute/#execution-options","title":"Execution Options","text":"<p>Below we applied <code>--rerun-incomplete</code>, which enables the pipeline to re-run any jobs the output of which is identified as incomplete, and <code>--latency-wait</code>, which request the pipeline pauses for the defined time awaiting an output file if not instantly accessible after a job, compensating for filesystem delay. Please note those options are OPTIONAL. For more options, please see the A Rule Execution Guide and the official Snakemake documentation.</p>"},{"location":"getting_started/execute/#option-a-local-execution","title":"Option A: Local Execution","text":"<p>If your computing environment does not require a job scheduler such as Slurm, you can run the pipeline locally. An example script is provided below. Make sure to replace the variables to relevant paths, the number of cores, and the time to wait for latency. </p> <pre><code>## path\nsmk_dir=/path/to/the/novascope/directory        # path to NovaScope repository\njob_dir=/path/to/the/job/directory              # The job directory should has the `config_job.yaml` file.\n\n## parameters\nNcores=&lt;number_of_cores&gt;                        # replace &lt;number_of_cores&gt; by the number of available CPU cores you wish to use\nwait_time=&lt;time_to_wait&gt;                        # Replace &lt;time_to_wait&gt; with a specific duration in seconds, e.g., 120.\n\n## execute the NovaScope pipeline\nsnakemake --latency-wait $wait_time -s ${smk_dir}/NovaScope.smk -d $job_dir --cores $Ncores --rerun-incomplete \n</code></pre> <p>See the following examples to see how to execute the pipeline locally:</p> <ul> <li>Minimal Test Run</li> <li>Shallow Liver Section</li> <li>Deep Liver Section</li> </ul>"},{"location":"getting_started/execute/#option-b-slurm-using-a-master-job","title":"Option B: SLURM using a Master Job","text":"<p>Tip</p> <p>If your computing environment support a job scheduler such Slurm, a recommended approach to submit a 'Master Job' that oversees and manage the status of all other jobs. </p> <p>First, make sure you have the Slurm configuration file available. The <code>--latency-wait</code> and <code>--rerun-incomplete</code> options are preset in the example Slurm configuration file, eliminating the need for manual specification.</p> <p>Now you need to establish the master job, of which the role is to monitor the progress of all tasks and handle job submissions. Create a file similar to the information below. Note that the details of the contents may vary based on your specific computing environment. </p> <p>Warning</p> <p>The master job requires minimal memory but an extended time limit to ensure all related jobs are submitted and completed. Otherwise, NovaScope will exit and unfinished jobs will not be executed or tracked.</p> <pre><code>#!/bin/bash\n####  Job configuration\n#SBATCH --account=&lt;account_name&gt;               # Replace &lt;account_name&gt; with your account identifier\n#SBATCH --partition=&lt;partition_name&gt;           # Replace &lt;partition_name&gt; with your partition name\n#SBATCH --job-name=&lt;job_name&gt;                  # Replace &lt;job_name&gt; with a name for your job\n#SBATCH --nodes=1                              # Number of nodes, adjust as needed\n#SBATCH --ntasks-per-node=1                    # Number of tasks per node, adjust based on requirement\n#SBATCH --cpus-per-task=1                      # Number of CPUs per task, adjust as needed\n#SBATCH --mem-per-cpu=&lt;memory_allocation&gt;      # Memory per CPU, replace &lt;memory_allocation&gt; with value, e.g., \"2000m\"\n#SBATCH --time=&lt;time_limit&gt;                    # Job time limit, replace &lt;time_limit&gt; with value, e.g., \"72:00:00\"\n#SBATCH --mail-user=&lt;your_email&gt;               # Replace &lt;your_email&gt; with your email address\n#SBATCH --mail-type=END,FAIL,REQUEUE           # Notification types for job status\n#SBATCH --output=./logs/&lt;log_filename&gt;         # Replace &lt;log_filename&gt; with the log file name pattern\n\n## path\nsmk_dir=/path/to/the/novascope/directory                             # path to NovaScope repository\njob_dir=/path/to/the/job/directory                                   # The job directory should has the `config_job.yaml` file.\nslurm_params=\"--profile /path/to/the/slurm/configuration/directory\"  # The slurm configuration directory should have the slurm configuration file: `config.yaml`.\n\n## execute the NovaScope pipeline\nsnakemake $slurm_params -s ${smk_dir}/NovaScope.smk -d $job_dir \n</code></pre> <p>Specific examples prepared for the three datasets are provided below:</p> <ul> <li>Minimal Test Run</li> <li>Shallow Liver Section</li> <li>Deep Liver Section</li> </ul> <p>Then submit the master job through <code>sbatch</code>:</p> <pre><code>sbatch submit_HPC.job\n</code></pre>"},{"location":"getting_started/execute/#option-c-slurm-via-command-lines","title":"Option C: SLURM via Command Lines","text":"<p>For a small number of quick jobs, you can execute NovaScope with Slurm using a single command line without a master job. </p> <p>This is similar to the local execution, but you need to specify the Slurm profile. Ensure the slurm configuration file is ready before proceeding. The <code>--latency-wait</code> and <code>--rerun-incomplete</code> options are pre-configured in the example slurm file.</p> <p>Warning</p> <p>It is important to remember that if you are logged out before all jobs have been submitted to Slurm, any remaining jobs, i.e., those haven't been submitted, will not be submitted.</p> <pre><code>## path\nsmk_dir=/path/to/the/novascope/directory                             # path to NovaScope repository\njob_dir=/path/to/the/job/directory                                   # The job directory should has the `config_job.yaml` file.\nslurm_params=\"--profile /path/to/the/slurm/configuration/directory\"  # The slurm directory should have the configuration file: `config.yaml`.\n\n## execute the NovaScope pipeline\nsnakemake $slurm_params -s ${smk_dir}/NovaScope.smk -d $job_dir\n</code></pre>"},{"location":"getting_started/intro/","title":"Getting Started with NovaScope","text":""},{"location":"getting_started/intro/#introduction","title":"Introduction","text":"<p>This tutorial provides an instruction of running NovaScope based on the three example datasets provided with the published protocol. </p> <p>Before downloading the example datasets, you must install NovaScope in your computing environment, and set up your own config file. </p> <p>In this tutorial, we will provide guidance on (a) how to access the example datasets, (b) how to set up your input configuration file, and (c)how to execute the NovaScope pipeline based on the prepared input files.</p>"},{"location":"getting_started/job_config/","title":"Configuring a NovaScope Run","text":""},{"location":"getting_started/job_config/#overview","title":"Overview","text":"<p>Once you have installed NovaScope and downloaded the input data, the next step is to configure a NovaScope run. This mainly involves preparing the input job configuration file (in YAML, <code>config_job.yaml</code>) for the run.</p>"},{"location":"getting_started/job_config/#preparing-input-config-files","title":"Preparing Input Config Files","text":"<p>Info</p> <p>The pipeline requires to have <code>config_job.yaml</code> file in the working directory, which will be indicated by <code>-d</code> or <code>--directory</code> when executing NovaScope, to specify all input files, output files, and parameters. </p> <p>For user's convenience, we provide separate example <code>config_job.yaml</code> files for the Minimal Test Run Dataset, Shallow Liver Section Dataset, and Deep Liver Section Dataset test runs.</p> <p>The details of each item specified in the <code>config_job.yaml</code> is described below:</p>"},{"location":"getting_started/job_config/#a-template-of-the-config-file","title":"A Template of the Config File","text":"<p>Below is a template of the <code>config_job.yaml</code> file. </p> <p>Mandatory fields are marked as \"REQUIRED FIELD\".</p> <pre><code>## Section to Specify Input Datta\ninput:\n  flowcell: &lt;flowcell_id&gt;                       ## REQUIRED FIELD (e.g. N3-HG5MC)\n  chip: &lt;chip_id&gt;                               ## REQUIRED FIELD (e.g. B08C)\n  species: &lt;species_info&gt;                       ## REQUIRED FIELD (e.g. \"mouse\")\n  lane: &lt;lane_id&gt;                               ## Optional. Auto-assigned based on chip_id's last letter if absent (A-&gt;1, B-&gt;2, C-&gt;3, D-&gt;4).\n  seq1st:                                       ## 1st-seq information\n    id: &lt;seq1st_id&gt;                             ## Optional. Defaults to \"L{lane}\" if absent.\n    fastq: &lt;path_to_seq1st_fastq_file&gt;          ## REQUIRED FIELD\n    layout: &lt;path_to_sbcd_layout&gt;               ## Optional. Default based on chip_id\n  seq2nd:                                       ## 2nd-seq information. See the \"Detailed Description of Individual Fields\" below.\n    - id: &lt;seq2nd_pair1_id&gt;                     ## Optional - for the first pair of FASTQs. Must be UNIQUE across all 2nd-seq FASTQ pairs, if provided.\n      fastq_R1: &lt;path_to_seq2nd_pair1_fastq_Read1_file&gt; ## REQUIRED FIELD - path to Read 1 FASTQ file,\n      fastq_R2: &lt;path_to_seq2nd_pair1_fastq_Read2_file&gt; ## REQUIRED FIELD - Read 2 FASTQ file\n    - id: &lt;seq2nd_pair2_id&gt;                     ## Optional - if there are &gt;1 pair of FASTQs\n      fastq_R1: &lt;path_to_seq2nd_pair2_fastq_Read1_file&gt;\n      fastq_R2: &lt;path_to_seq2nd_pair2_fastq_Read2_file&gt;\n    # ... (if there are more 2nd-seq FASTQ files)\n  run_id: &lt;run_id&gt;                              ## Optional. See the \"Detailed Description of Individual Fields\" below.\n  unit_id: &lt;unit_id&gt;                            ## Optional. See the \"Detailed Description of Individual Fields\" below.\n  histology: &lt;path_to_the_input_histology_file&gt; ## Optional. Only if histology alignment is needed.\n\n## Output\noutput: &lt;output_directory&gt;                      ## REQUIRED FIELD (e.g. /path/to/output/directory)\nrequest:                                        ## See the \"Detailed Description of Individual Fields\" below.\n  - &lt;required_output1&gt;                          ## REQUIRED FIELD (e.g. sge-per-run)\n  - &lt;required_output2&gt;                          ## Optionally, you can request multiple outputs\n  # ...\n\n## Environment\nenv_yml: &lt;path_to_config_env.yaml_file&gt;         ## If absent, NovaScope use the \"config_env.yaml\" file in the `info` subdirectory in the Novascope repository.\n\n## ================================================\n##\n##  Additional Fields:\n## \n##    The \"upstream\", \"histology\", and \"downstream\" parameters are included below, along side the default values.\n##    Revise and enable the following parameters ONLY IF you wish to utilize values different than the default.\n##\n## ================================================\n\n### UNCOMMENT RELEVANT LINES TO ENABLE THE ADDITIONAL PARAMETERS\n#upstream:\n#  fastq2sbcd:\n#    format: DraI32          ## Example data uses DraI31, but DraI32 is a typical format.\n#\n#  sbcd2chip:                ## specify the parameters for sbcd2chip\n#    gap_row: 0.0517\n#    gap_col: 0.0048\n#    dup_maxnum: 1\n#    dup_maxdist: 1\n#\n#  smatch:                   ## specify the parameters for smatch\n#    skip_sbcd: 0            ## If absent, default skip_sbcd follows the fastq2sbcd format: 1 for DraI31 and 0 for DraI32.\n#    match_len: 27           ## Length of spatial barcode considered to be a perfect match.\n#\n#  align:                    ## specify the parameters for align (STARsolo)\n#    min_match_len: 30       ## A minimum number of matching bases.\n#    min_match_frac: 0.66    ## A minimum fraction of matching bases.\n#    len_sbcd: 30            ## Length of spatial barcode (in Read 1) to be copied to output FASTQ file (Read 1).\n#    len_umi: 9              ## Length of UMI barcode (in Read 2) to be copied to output FASTQ file (Read 1).\n#    len_r2: 101             ## Length of read 2 after trimming (including randomers).\n#    exist_action: overwrite ## Skip the action or overwrite the file if an intermediate or output file already exists. Options: \"skip\", and \"overwrite\".\n#    resource:               ## See the \"Detailed Description of Individual Fields\" below.\n#      assign_type: stdin\n#      stdin:\n#        partition: standard\n#        threads: 10\n#        memory: 70000m\n#\n#  dge2sdge:                 ## specify the parameters for dge2sdge\n#    layout: null            ## If absent, the layout file in the info/assets/layout_per_section_basis/layout.1x1.tsv will be used for RGB plots.\n#\n#  gene_visual: null         ## If you have a specific set of genes to visualize, specify the path to a file containing a list of gene names (one per line) here. By default, the top five genes with the highest expression are visualized.\n#\n#  visualization:            ## specify the parameters for visualization\n#    drawxy:\n#      coord_per_pixel: 1000\n#      intensity_per_obs: 50\n#      icol_x: 3\n#      icol_y: 4\n#\n#histology:                 ## specify the parameters for histology alignment using historef\n#  resolution: 10\n#  figtype: \"hne\"           ## Options: \"hne\", \"dapi\", and \"fl\".\n#\n#downstream:                 \n#  gene_filter:             ## Specify the criteria for gene filtering in a manner compatible with regular expressions, which will be applied when creating the FICTURE-compatible SGE and hexagonal SGE.\n#   keep_gene_type: \"protein_coding,lncRNA\"    # genes to keep\n#   rm_gene_regex: \"^Gm\\\\d+|^mt-|^MT-\"         # genes to remove\n#  segment:                 ## specify the parameters for grouping the pixels into hexagons\n#    precision: 2           ## specify the number of digits to store spatial location (in um, 0 for integer)\n#    min_pixel_per_unit: 10 ## specify a minimum UMI count of output hexagons\n#    mu_scale: 1000         ## Specify coordinate to um translate for hexagon. By default, we consider the spatial digital gene expression matrix (SGE) is in nano meter.\n#    char:                  ## specify the characteristics for the hexagons\n#      - solofeature: gn    ## specify the genomic feature to create hexagon\n#        trainwidth: 24     ## specify the size for a hexagonal grid\n#        segmentmove: 1     ## Specify if the SGE is based on overlapping hexagons or non-overlapping hexagon. The default value 1 will create non-overlapping hexagons.\n</code></pre>"},{"location":"getting_started/job_config/#detailed-description-of-individual-fields","title":"Detailed Description of Individual Fields","text":""},{"location":"getting_started/job_config/#input","title":"Input","text":"<p>Tip</p> <p>NovaScope supports using relative paths in the job configuration file, which should be relative to the working directory. If a relative path is found, NovaScope automatically obtains its real path and uses it in the process.</p> <ul> <li> <p><code>seq1st</code>:</p> <ul> <li> <p><code>id</code>: The <code>id</code> will be used to organize the 1st-seq FASTQ files. Make sure the <code>id</code> parameter for 1st-seq in the corresponding flowcell is unique.  </p> </li> <li> <p><code>layout</code>: A spatial barcode (sbcd) layout file to provide the layout of tiles in a chip with the following format. If absent, NovaScope will automatically look for the sbcd layout within the NovaScope repository at info/assets/layout_per_tile_basis, using the section chip ID for reference.     <pre><code>lane  tile  row  col  rowshift  colshift\n3     2556  1    1    0         0\n3     2456  2    1    0         0.1715\n</code></pre></p> <ul> <li><code>lane</code>: Lane IDs;</li> <li><code>tile</code>: Tile IDs;</li> <li><code>row</code> &amp; <code>col</code>: The layout position;</li> <li><code>rowshift</code> &amp; <code>colshift</code>: The gap information</li> </ul> </li> </ul> </li> <li> <p><code>seq2nd</code>: This parameter requires all FASTQ pairs associated with the input section chip to be provided under <code>seq2nd</code>. </p> How to generate <code>seq2nd_pair_id</code>? <p>If an ID is not specified, NovaScope will automatically generate one using the format <code>&lt;flowcell_id&gt;.&lt;chip_id&gt;.&lt;randomer&gt;</code>, where <code>randomer</code> is the last 5 digits of the md5 hash of the real path of the read 1 FASTQ file from the 2nd-seq.</p> </li> <li> <p><code>run_id</code>: Only needed if alignment is required to generate the requested output. It is used as an identifier for alignment and Spatial Digital Gene Expression matrices (SGEs) to differentiate between input 2nd-seq FASTQ files. This is particularly useful when generating SGEs using the same 1st-seq files but different 2nd-seq files. If not provided, NovaScope will generate it based on the flowcell ID, chip ID, and all input 2nd-seq read 1 FASTQ files.</p> How to generate <code>run_id</code>? <p>NovaScope automatically generates <code>run_id</code> in the format <code>&lt;flowcell_id&gt;-&lt;chip_id&gt;-&lt;species&gt;-&lt;randomer&gt;</code>. The <code>randomer</code> is created by sorting all input seq2nd_pair_id, concatenating these seq2nd_pair_id into a single long string, and then computing the md5 hash of this string. The last 5 digits of this hash are used as the <code>randomer</code>.</p> </li> <li> <p><code>unit_id</code>: Only needed if reformat feature is required to generate the requested output. It acts as an identifier for SGEs that are prepared for reformatting. This identifier is especially useful when users wish to manually modify SGE outside of NovaScope and then proceed to reformat both the original and modified SGEs. The <code>unit_id</code> ensures clear distinction between the original and modified datasets.</p> How to generate <code>unit_id</code> <p>If <code>unit_id</code> is not specified and reformatting is requested, it will default to <code>&lt;run_id&gt;-default</code>, indicating that no manual preprocessing has occurred. </p> <p>Users who prefer to reformat manually modified SGEs should define their own <code>unit_id</code>. We recommend incorporating <code>run_id</code> into the <code>unit_id</code> to maintain a clear trace of the dataset lineage.</p> </li> </ul>"},{"location":"getting_started/job_config/#output","title":"Output","text":"<p>The output directory will be used to organize the input files and store output files. Please see the structure directory here.</p>"},{"location":"getting_started/job_config/#requests","title":"Requests","text":"<p>The pipeline interprets the requested output files via <code>request</code> and determines the execution flow.</p> <p>Info</p> <p>The <code>request</code> parameter should indicate the final output required, and all intermediary files contributing to the final output will be automatically generated (i.e., the dependencies between rules). </p> <p>Below are the options with their final output files and links to detailed output information. For more insights into the excution flow, please consult the execution flow by request alongside the rulegraph. </p> Option Main/Final Output Files Details <code>sbcd-per-flowcell</code> Spatial barcode map (per-tile basis) and Manifest file for a flowcell fastq2sbcd <code>sbcd-per-chip</code> Spatial barcode map for a section chip, Image of spatial barcode distribution sbcd2chip <code>smatch-per-chip</code> File with matched spatial barcodes, Image of matched barcode spatial distribution smatch <code>align-per-run</code> Binary Alignment Map (BAM) file, Digital gene expression matrix (DGE) for genomic features align <code>sge-per-run</code> Spatial digital gene expression matrix (SGE), Spatial distribution images for transcripts dge2sdge <code>hist-per-run</code> Geotiff file for coordinate transformation between SGE and histology image, A Resized TIFF file historef <code>transcript-per-unit</code> SGE in in the FICTURE-compatible format sdgeAR_reformat <code>segment-per-unit</code> Hexagon-based SGE in the 10x genomics format sdgeAR_segment"},{"location":"getting_started/job_config/#upstream-downstream","title":"Upstream &amp; Downstream","text":"<p>Parameter details for the <code>upstream</code> and <code>downstream</code> fields are outlined in the NovaScope Walkthrough, under the specific rule pages to which they apply.</p> <ul> <li><code>align</code><ul> <li> <p><code>resource</code>: Only applicable for HPC users.</p> <ul> <li><code>assign_type</code>: two available options for how NovaScope allocates resources for alignment. The options include <code>\"stdin\"</code> (recommended) and <code>\"filesize\"</code>. Details for each option are provided in the blocks below. </li> </ul> Option <code>stdin</code> <p>Advantages: - Directly allocates resources as specified in the <code>stdin</code> field, bypassing calculations for precision in resource management. - Enables customization of resources for different datasets in the job configuration file, allowing for optimization of costs based on file size.</p> <p>Disadvantages: - Requires users to specify resources for each job unless default settings (partition name, threads, memory) fit the computing environment. An example is provided in the template.</p> Option <code>filesize</code> <p>Advantages: - Automatically allocates resources based on the total size of input 2nd-seq FASTQ files and specified computing resources in the environment configuration file. - Once computing resources are specified in the environment file, they automatically apply to all jobs, simplifying the setup.</p> <p>Disadvantages: - Requires computing time to calculate the total size of input files, potentially delaying the start of data processing.</p> <p>The resource allocation strategy is as follows:</p> Total File Size (GB) Memory Allocated for Alignment (GB) Under 200 70 200 to 400 140 Over 400 330 </li> </ul> </li> </ul>"},{"location":"getting_started/output/","title":"Expected Output from NovaScope","text":""},{"location":"getting_started/output/#output-directory-structure","title":"Output Directory Structure","text":"<p>The directory passed through <code>output</code> paramter in the <code>config_job.yaml</code> will be organized as follows, </p> <pre><code>\u251c\u2500\u2500 align\n\u251c\u2500\u2500 histology\n\u251c\u2500\u2500 match\n\u251c\u2500\u2500 seq1st\n\u2514\u2500\u2500 seq2nd\n</code></pre>"},{"location":"getting_started/output/#seq1st","title":"seq1st","text":"<p>The <code>seq1st</code> directory is structured for organizing 1st sequencing FASTQ files and spatial barcode maps. It includes:</p> <ul> <li>A <code>fastqs</code> subdirectory for all input 1st sequencing FASTQ files via symlink.</li> <li>Two subdirectories for spatial barcode maps:<ul> <li><code>sbcds</code> for maps of individual tiles from the 1st sequencing,</li> <li><code>nbcds</code> for a map organized on a per-chip basis, used in later processing.</li> </ul> </li> </ul> <pre><code>\u2514\u2500\u2500 seq1st\n    \u2514\u2500\u2500 &lt;flowcell_id&gt;\n        \u251c\u2500\u2500 fastqs\n        |   \u2514\u2500\u2500 &lt;seq1st_id&gt;.fastq.gz\n        \u251c\u2500\u2500 nbcds\n        |   \u2514\u2500\u2500 &lt;chip_id&gt;\n        |       \u251c\u2500\u2500 1_1.sbcds.sorted.tsv.gz\n        |       \u251c\u2500\u2500 1_1.sbcds.sorted.png\n        |       \u251c\u2500\u2500 dupstats.tsv.gz\n        |       \u2514\u2500\u2500 manifest.tsv\n        \u2514\u2500\u2500 sbcds\n           \u2514\u2500\u2500 &lt;chip_id&gt;\n                \u2514\u2500\u2500 ...    # spatial maps of individual tile, and a manifest file \n</code></pre>"},{"location":"getting_started/output/#seq2nd","title":"seq2nd","text":"<p>The <code>seq2nd</code> directory is dedicated to managing all input 2nd sequencing FASTQ files via symlinks. Each pair will be organized in one folder named by the 2nd sequencing ID provided via the job configuration file.</p> <p>The following example demonstrates the directory structure using two pairs of input 2nd sequencing FASTQ files:</p> <pre><code>\u2514\u2500\u2500 seq2nd\n    \u251c\u2500\u2500 &lt;seq2nd_id1&gt;\n    |   \u251c\u2500\u2500 &lt;seq2nd_id1&gt;.R1.fastq.gz\n    |   \u2514\u2500\u2500 &lt;seq2nd_id1&gt;.R2.fastq.gz\n    \u2514\u2500\u2500 &lt;seq2nd_id2&gt;\n        \u251c\u2500\u2500 &lt;seq2nd_id2&gt;.R1.fastq.gz\n        \u2514\u2500\u2500 &lt;seq2nd_id2&gt;.R2.fastq.gz\n</code></pre>"},{"location":"getting_started/output/#match","title":"match","text":"<p>The <code>match</code> directory houses the outcomes of aligning second sequencing reads with spatial barcodes for the corresponding chip section.</p> <pre><code>\u2514\u2500\u2500 match\n    \u2514\u2500\u2500 &lt;flowcell_id&gt;\n        \u2514\u2500\u2500 &lt;chip_id&gt;\n            \u2514\u2500\u2500 &lt;seq2nd_id1&gt;\n                \u251c\u2500\u2500 &lt;seq2nd_id1&gt;.R1.counts.tsv\n                \u251c\u2500\u2500 &lt;seq2nd_id1&gt;.R1.match.png\n                \u251c\u2500\u2500 &lt;seq2nd_id1&gt;.match.sorted.uniq.tsv.gz\n                \u2514\u2500\u2500 &lt;seq2nd_id1&gt;.summary.tsv\n</code></pre>"},{"location":"getting_started/output/#histology","title":"histology","text":"<p>The <code>histology</code> directory is designated for holding both the input histology file and the histology images aligned with the spatial coordinates of the SGE.</p> <pre><code>\u2514\u2500\u2500 histology\n    \u2514\u2500\u2500 &lt;flowcell_id&gt;\n        \u2514\u2500\u2500 &lt;chip_id&gt;\n            \u251c\u2500\u2500 raw\n            |   \u2514\u2500\u2500 ...     # a raw histology file\n            \u2514\u2500\u2500 aligned\n                \u2514\u2500\u2500 ...     # aligned histology files\n</code></pre>"},{"location":"getting_started/output/#align","title":"align","text":"<p>The <code>align</code> directory encompasses several subdirectories, including: </p> <ul> <li><code>bam</code> for alignment outcomes such as the BAM file, summary metrics, and visualizations;</li> <li><code>sge</code> for a spatial gene expression matrix (SGE) and visualizations; </li> </ul> <pre><code>\u2514\u2500\u2500 align\n    \u2514\u2500\u2500 &lt;flowcell_id&gt;\n        \u2514\u2500\u2500 &lt;chip_id&gt;\n        \u00a0\u00a0 \u2514\u2500\u2500 &lt;run_id&gt;\n                \u251c\u2500\u2500 bam\n                |   \u2514\u2500\u2500 ...     \n        \u00a0\u00a0     \u2514\u2500\u2500 sge\n                    \u2514\u2500\u2500 ...     \n</code></pre>"},{"location":"getting_started/output/#analysis","title":"analysis","text":"<p>The <code>analysis</code> directory includes three subdirectory mainly for the reformatting SGE:</p> <ul> <li><code>sgeAR</code> for the SGE before reformatting, where the \"AR\" stands for analysis-ready,</li> <li><code>preprocess</code> for the SGE in the FICTURE format,</li> <li><code>segment</code> for the hexagon-based SGE in the 10x genomics format.</li> </ul> <pre><code>\u2514\u2500\u2500 analysis\n    \u2514\u2500\u2500 &lt;run_id&gt;\n        \u2514\u2500\u2500 &lt;unit_id&gt;\n            \u251c\u2500\u2500 preprocess\n            |   \u2514\u2500\u2500 ...  \n            \u251c\u2500\u2500 segment\n            |   \u2514\u2500\u2500 ...  \n            \u2514\u2500\u2500 sgeAR\n                \u2514\u2500\u2500 ...  \n</code></pre> The <code>sgeAR</code> Subfolder and Manual Preprocess <p>The <code>sgeAR</code> subfolder is specifically designed to host input SGEs that require reformatting. This subfolder is particularly useful when users wish to manually preprocess SGEs, such as applying boundary filtering, before they undergo reformatting.</p> <p>To manually preprocess an SGE:</p> <ul> <li>Preprocess the SGE: Users must manually preprocess the SGE according to their specific requirements.</li> <li>Name the dataset: After preprocessing, the dataset should be named and referred to as <code>unit_id</code>.</li> <li>Save the preprocessed SGE: Place the manually preprocessed SGE in the <code>sgeAR</code> subfolder.</li> <li>Preprare a coordinate meta file Prepare a <code>barcodes.minmax.tsv</code> with the minimum and maximum of X and Y coordinates in the <code>sgeAR</code> subfolder.</li> <li>Update the job configuration file: Provide the <code>unit_id</code> in the job configuration file to ensure it is recognized in subsequent processing steps.</li> </ul> <p>Automatic Handling: If reformatting features are requested without manually preparing the SGE in the <code>sgeAR</code> as outlined, NovaScope will automatically generate a <code>unit_id</code>. It will then link the original SGE from the <code>sge</code> subdirectory to the <code>sgeAR</code>, facilitating seamless processing.</p>"},{"location":"getting_started/output/#downstream-analysis","title":"Downstream Analysis","text":"<p>The aligned sequenced reads can be directly used for tasks that require read-level information, such as allele-specific expression or somatic variant analysis. The SGE can also be analyzed with many software tools, such as Latent Dirichlet Allocation (LDA) and Seurat. </p> <p>An exemplary downstream analysis is provided at NovaScope-exemplary-downstream-analysis.</p>"},{"location":"home/documentation_overview/","title":"Documentation Overview","text":"<p>The current documentation of NovaScope include the following sections:</p> <p>Home:</p> <ul> <li>Documentation Overview: Summarizes the contents and structure of the NovaScope documentation.</li> <li>Workflow Structure: Describes NovaScope's workflow, including rules and their dependencies.</li> </ul> <p>Installation:</p> <ul> <li>Installing NovaScope: Details of installing required softwares and acquiring reference database.</li> <li>Environment Setup: Outlines how to prepare a configuration file for computing environment.</li> <li>Slurm: (Optional) Guidance on setting up a configuration for the SLURM job scheduler.</li> </ul> <p>Getting Started:</p> <ul> <li>Introduction: A quick introduction of using NovaScope with example datasets.</li> <li>Accessing Input Data: Information on accessing three provided example datasets.</li> <li>Job Configuration: Instructions for preparing a configuration file for a job.</li> <li>Execute NovaScope: Describes three ways for running NovaScope.</li> <li>Output: Explains the output directory structure and how to utilize the generated data.</li> </ul> <p>NovaScope Walkthrough:</p> <ul> <li>A Rule Execution Guide: Essential concepts and rule execution flows by <code>request</code>.</li> <li>Specific Rule Instructions: Detailed instructions for all rules.</li> </ul>"},{"location":"home/workflow_structure/","title":"Workflow Structure","text":"<p>The workflow of NovaScope can be visualized in the following rule graph.</p> <p>Figure 2: The overall flow and dependencies between rules: Each node in the graph represents a rule within your Snakemake workflow. Each arrow among nodes stands for the rule dependency among rules, with the direction that points from prerequisite rules to a dependent rule. The prerequisite rules must be executed before the dependent rule can start.</p>"},{"location":"installation/env_setup/","title":"Setting up a Environment YAML File","text":"<p>NovaScope requires a YAML file to configure the environment. This environment configuration file (<code>config_env.yaml</code>) is used to specify the paths to the required tools, reference databases, and Python environment. </p> <p>Below is a brief description of all the items in the YAML file. </p> <p>Tip</p> <p>To create your own <code>config_env.yaml</code> file for the environment setup, you may copy from our example available in our GitHub repository. Remember to replace the placeholders with your specific input variables to customize it according to your needs.</p>"},{"location":"installation/env_setup/#tools","title":"Tools","text":"<p>The pipeline automatically detects and includes undefined tools in the system path, allowing for their use without manual configuration.</p> <pre><code>tools:\n  spatula: /path/to/spatula/bin/spatula                     ## Default: \"spatula\"\n  samtools: /path/to/samtools/samtools                      ## Default: \"samtools\"\n  star: /path/to/STAR_2_7_11b/bin/Linux_x86_64_static/STAR  ## Default: \"STAR\"\n  ficture: /path/to/ficture/repository                      ## (Optional) Default: \"ficture\"     \n</code></pre> <code>samtools</code> <p>For users in High-Performance Computing (HPC) environments with <code>samtools</code> installed, it's feasible to use <code>envmodules</code> (see Environment Modules) to load <code>samtools</code> rather than defining its path here.</p>"},{"location":"installation/env_setup/#optional-environment-modules","title":"(Optional) Environment Modules","text":"<p>Info</p> <p>Only applicable to HPC environments. For local executions, remove this section from <code>config_env.yaml</code>.</p> <p>For HPC users, it is feasible to use the <code>envmodules</code> section to load the required software tools as modules. If a tool is not listed in the <code>envmodules</code> section, the pipeline will assume it's installed system-wide. </p> <p>Tip</p> <p>The version information is required.</p> <pre><code>envmodules:\n  python: \"python/&lt;version_information&gt;\"\n  gcc: \"gcc/&lt;version_information&gt;\"\n  gdal: \"gdal/&lt;version_information&gt;\"\n  imagemagick: \"imagemagick/&lt;version_information&gt;\"\n  # snakemake: \"snakemake/&lt;version_information&gt;\"\n  # samtools: \"Bioinformatics &amp;&amp; samtools\"\n</code></pre> <code>python</code> <p>If your Python environment was set up using a Python accessed through a module, specify the same Python module in the envmodules section to maintain the environment. If using a local Python installation (not through <code>module load</code>), DO NOT INCLUDE any Python module here.</p> <code>samtools</code> <p>Using <code>envmodules</code> to load <code>samtools</code> can be an alternative to specifying its path in <code>tools</code>. The given example is designed for instances where <code>samtools</code> is integrated into the <code>Bioinformatics</code> module system, which necessitates loading the <code>Bioinformatics</code> module prior to loading <code>samtools</code>. In this case, provide all modules that required to be loaded in the correct order, joint by <code>&amp;&amp;</code>.</p>"},{"location":"installation/env_setup/#reference-genome-index","title":"Reference Genome Index","text":"<p>Please list every reference database used for alignment here. The reference data can be obtained via the cellranger download page. Example instructions to build STAR index from the reference file is described in the Requirements section.</p> <p>Tip</p> <p>Please ensure the reference genome indices correspond to the species of your input data. </p> <pre><code>ref:\n  align:\n    mouse: \"/path/to/refdata-gex-GRCm39-2024-A/star_2.7_11b\"\n    human: \"/path/to/refdata-gex-GRCh39-2024-A/star_2.7_11b\"\n   #...\n</code></pre>"},{"location":"installation/env_setup/#python-environment","title":"Python Environment","text":"<p>You also need to specify the path of Python virtual environment by modifying the following line.</p> <pre><code>pyenv: \"/path/to/python/virtual/env\"\n</code></pre>"},{"location":"installation/env_setup/#optional-computing-capabilities","title":"(Optional) Computing Capabilities","text":"<p>Info</p> <p>Only applicable to HPC environments.</p> <p>NovaScope provides two methods for specifying resources for the alignment process:</p> <ul> <li>Option <code>stdin</code> allows users to define resources manually in the job configuration file.</li> <li>Option <code>filesize</code> allows NovaScope to automatically allocate resources based on the size of the input files and the available computational resources defined in this environment configuration file. ONLY when using Option <code>filesize</code> must users specify the computing resources available. </li> </ul> <p>For more information on activating Option <code>stdin</code> or <code>filesize</code> and the resource allocation strategy for Option <code>filesize</code>, visit the Job Configuration page.</p> <p>An example of how to configure these settings.</p> <pre><code>available_nodes:\n  - partition: standard     # partition name\n    max_n_cpus: 20          # the maximum number of CPUs per node\n    mem_per_cpu: 7g         # the memory allocation per CPU \n  - partition: largemem\n    max_n_cpus: 10\n    mem_per_cpu: 25g\n</code></pre>"},{"location":"installation/requirement/","title":"Installing NovaScope","text":"<p>Installing NovaScope involves multiple steps. This document provides instructions on how to install the necessary software tools and obtain reference datasets.</p>"},{"location":"installation/requirement/#installing-snakemake","title":"Installing Snakemake","text":"<p>Snakemake orchestrates the workflow of NovaScope pipeline. </p> <p>Info</p> <p>NovaScope has been tested for compatibility with Snakemake v7.29.0 and v8.6.0.</p>"},{"location":"installation/requirement/#checking-snakemake-installation","title":"Checking Snakemake Installation","text":"<p>If you are unsure whether Snakemake is installed in your system or not, you can check by running the following command:</p> <pre><code>snakemake --version\n</code></pre> <p>In some systems that supports <code>module</code>, you may be able to load the <code>snakemake</code> module using the following command:</p> <pre><code>## check if snakemake is available as a module\nmodule avail snakemake\n\n## load the available module (specify the version if necessary)\nmodule load snakemake\n</code></pre>"},{"location":"installation/requirement/#installing-snakemake-using-conda-and-mamba","title":"Installing Snakemake Using Conda and Mamba","text":"<p>If you need to install Snakemake, below is a simplified sequence of instruction. Please refer to official Snakemake documentation for more detailed instructions.</p> <p>Tip</p> <p>It is recommended to install Snakemake using conda and/or mamba. </p> <p>Info</p> <p>If you do not have Python, it will be installed as part of setting up Miniconda.</p> <pre><code>## download miniconda\nwget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh\n\n## install miniconda\nbash Miniconda3-latest-Linux-x86_64.sh\n## Follow the on-screen instructions to complete the installation. \n\n## Activate the Miniconda installation:\n## IMPORTANT: change /path/to/miniconda to the path you installed miniconda\neval \"$(/path/to/miniconda3/bin/conda shell.bash hook)\"\n\n## If you included conda initialization in .bashrc the above line can be replaced with\n## source ~/.bashrc\n\n## create a new conda environment\n## this step ensures that this version of Python is installed within the environment if it isn't already available\npython_version=3.9      # replace 3.9 by your desired version\nconda create -n snakemake-env python=$python_version\n\n## activate the new environment\nconda activate snakemake-env\n\n## install mamba in the conda environment\nconda install mamba -n snakemake-env\n\n## activate the environment to ensure mamba is correctly set up\nconda activate snakemake-env\n\n## install snakemake using mamba\nmamba install snakemake\n\n## verify the installation of snakemake\nsnakemake --version\n</code></pre>"},{"location":"installation/requirement/#configuring-python-virtual-environment","title":"Configuring Python Virtual Environment","text":""},{"location":"installation/requirement/#python","title":"Python","text":"<p>Info</p> <p>NovaScope has been tested for compatibility with Python v3.9.12, v3.10, and v3.12.2.</p> <p>If you don't have Python installed on your system and you follow the above Snakemake installation instructions, Python of the specified version should be installed during the process. </p> <p>If you want to verify the installation or the version of Python on your system, run the following command:</p> <pre><code>python --version\n</code></pre>"},{"location":"installation/requirement/#python-environment","title":"Python Environment","text":"<p>We recommend creating a new Python environment for NovaScope. If you already have an existing Python environment with all required packages (see pyenv_req.txt), you may skip this step. Below is an example of creating a new Python environment:</p> <pre><code>## First, we recommend activating conda/mamba environment before setting up venv, using:\n# eval \"$(/path/to/miniconda3/bin/conda shell.bash hook)\"\n# conda activate snakemake-env\n##\n## set the path to the python virtual environment directory\npyenv_dir=/path/to/python/virtual/environment/directory  ## provide the path of venv\n## pyenv_dir=./venvs   ## uncomment this line if you want to create virtual environment locally\npyenv_name=novascope_venv\nsmk_dir=/path/to/the/novascope/directory\n\n## create the python virtual environment (need to be done only once)\nmkdir -p ${pyenv_dir}\ncd ${pyenv_dir}\npython -m venv ${pyenv_name}\n\n## activate the python environment (every time you want to use the environment)\nsource ${pyenv_name}/bin/activate\n\n## install the required packages (need to be done only once)\npip install -r ${smk_dir}/installation/pyenv_req.txt\n</code></pre>"},{"location":"installation/requirement/#installing-other-dependent-tools","title":"Installing Other Dependent Tools","text":"<p>NovaScope depends on a number of software tools, detailed below. The versions specified for each software tool have been verified for compatibility with our pipeline, though other versions may also be compatible.</p> <ul> <li>STARsolo (v2.7.11b)</li> <li>samtools (v1.13; v1.14; v1.19)</li> <li>spatula (v0.1.0)</li> <li>ImageMagick (7.1.0-25.lua and 7.1.1-30)</li> <li>GDAL (v3.5.1) (Optional, required for histology alignments)</li> </ul> <p>We provide an example work log documenting the installation of the aforementioned software tools.</p>"},{"location":"installation/requirement/#installing-novascope_1","title":"Installing NovaScope","text":"<p>To install NovaScope, clone the repository from GitHub using the following command:</p> <pre><code>git clone https://github.com/seqscope/NovaScope.git\n</code></pre>"},{"location":"installation/requirement/#preparing-reference-genomes","title":"Preparing Reference Genomes","text":"<p>The reference genome for the species of interest must be downloaded and indexed for alignment. STARsolo accepts the reference genomes prepared by cellranger, therefore, one of the simplest way is to download the reference genome from the cellranger download page.</p> <p>Given STAR index packaged by the cellranger download is outdated and will not be compatible with the latest version of STARsolo, we recommend indexing it using the latest version of STARsolo. For human and mouse, we provided examples below to prepare the reference genome. For other species, please follow the instructions provided by cellranger or STARsolo to prepare the reference genome. </p> <p>Please note that this indexing process will take A LOT OF TIME, typically a few to several hours.</p> Mouse <p>The recommended reference genome for mouse is GRCm39. </p> <pre><code>## download the reference genome package\ncurl -O \"https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-GRCm39-2024-A.tar.gz\"\n\n## uncompressed the tar file\ntar -xvf refdata-gex-GRCm39-2024-A.tar.gz\ncd refdata-gex-GRCm39-2024-A\n\n## uncompress GTF file\ngzip -d genes/genes.gtf.gz\n\n## index the reference genome\nSTARBIN=/path/to/STAR_2.7.11b/Linux_x86_64_static/STAR\n${STARBIN} --runMode genomeGenerate \\\n    --runThreadN 1 \\\n    --genomeDir ./star_2_7_11b \\\n    --genomeFastaFiles ./fasta/genome.fa \\\n    --genomeSAindexNbases 14 \\\n    --genomeChrBinNbits 18 \\\n    --genomeSAsparseD 3 \\\n    --limitGenomeGenerateRAM 17179869184 \\\n    --sjdbGTFfile ./genes/genes.gtf\n</code></pre> Human <p>The recommended reference genome for human is GRCh38.</p> <pre><code>## download the reference genome package\ncurl -O \"https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-GRCh38-2024-A.tar.gz\"\n\n## uncompressed the tar file\ntar -xvf refdata-gex-GRCh38-2024-A.tar.gz\ncd refdata-gex-GRCh38-2024-A\n\n## uncompress GTF file\ngzip -d genes/genes.gtf.gz\n\n## index the reference genome\nSTARBIN=/path/to/STAR_2.7.11b/Linux_x86_64_static/STAR\n${STARBIN} --runMode genomeGenerate \\\n    --runThreadN 1 \\\n    --genomeDir ./star_2_7_11b \\\n    --genomeFastaFiles ./fasta/genome.fa \\\n    --genomeSAindexNbases 14 \\\n    --genomeChrBinNbits 18 \\\n    --genomeSAsparseD 3 \\\n    --limitGenomeGenerateRAM 17179869184 \\\n    --sjdbGTFfile ./genes/genes.gtf\n</code></pre>"},{"location":"installation/requirement/#optional-install-the-historef-package","title":"(Optional) Install the historef Package","text":"<p>Info</p> <p>Only required if you want to align your histology images with the spatial gene expression data. </p> <p>Below is an example instruction to install the historef package in the same python environment you built in Configuring Python Virtual Environment.</p> <p>To access the most recent version, please see its GitHub repository.</p> <pre><code>### activate your python environment\n### Both the $pyenv_dir and $pyenv_name were defined in Configuring Python Virtual Environment.\nsource ${pyenv_dir}/$pyenv_name/bin/activate\n\n### download the historef package\nwget -P ${smk_dir}/installation https://github.com/seqscope/historef/releases/download/v0.1.2/historef-0.1.2-py3-none-any.whl\n\n## install the historef package\npip install ${smk_dir}/installation/historef-0.1.2-py3-none-any.whl\n</code></pre>"},{"location":"installation/requirement/#optional-install-the-ficture-package","title":"(Optional) Install the FICTURE Package","text":"<p>Info</p> <p>Only required if you want to apply the NovaScope additional reformat features.</p> <p>NovaScope additional reformat features including the transformation of the spatial digital gene expression matrix (SGE) into a format compatible with FICTURE, and the pixel organization into user-defined hexagonal grids in the 10x genomics format. To utilize these features, users are advised to follow the FICTURE installation guidelines provided in its tutorial.</p>"},{"location":"installation/slurm/","title":"Snakemake with Slurm","text":"<p>Tip</p> <p>We recommended to integrate SLURM scheduler with Snakemake, which can automate the process of submitting your jobs.</p> <p>Info</p> <p>Please be aware that Snakemake introduced significant updates for cluster configuration starting from version 8. Thus, we advise checking to verify your Snakemake version using <code>snakemake --version</code>. </p> <p>In NovaScope, we utilized a cluster configuration profile to define the details of the cluster and resources given its consistency and time-saving benefits. More details are provided below. Those files were crafted with inspiration from the smk-simple-slurm repository.</p>"},{"location":"installation/slurm/#a-cluster-configuration-file-for-snakemake-v7290","title":"A Cluster Configuration file for Snakemake v7.29.0","text":"<p>Create a <code>config.yaml</code> with the following settings. Please substitute the placeholders below, marked with <code>&lt;&gt;</code>, to suit your specific case. Please see our example file at slurm/v7.29.0/config.yaml. </p> <pre><code>## Cluster Configuration\n## The following setting also aids in organizing log files by creating rule-specific subdirectories within the job's log directory, each holding its own output and error files.\ncluster:\n  mkdir -p logs/{rule}/ &amp;&amp;\n  sbatch\n    --job-name={rule}_{wildcards}\n    --output=logs/{rule}/{rule}___{wildcards}___%j.out\n    --error=logs/{rule}/{rule}___{wildcards}___%j.err\n    --account={resources.account}\n    --partition={resources.partition}\n    --mem={resources.mem}\n    --time={resources.time}\n    --cpus-per-task={threads}\n    --parsable\n    --nodes={resources.nodes}\n\n## Default Resources for Jobs\ndefault-resources:\n  - partition=&lt;your_default_partition&gt;    # replace &lt;your_default_partition&gt; with your actual partition name\n  - mem=&lt;default_memory_allocation&gt;       # replace &lt;default_memory_allocation&gt; with memory, e.g., \"4G\"\n  - time=&lt;default_time_limit&gt;             # replace &lt;default_time_limit&gt; with time, e.g., \"01:00:00\"\n  - nodes=&lt;default_number_of_nodes&gt;       # replace &lt;default_number_of_nodes&gt; with nodes, e.g., \"1\"\n  - account=&lt;default_account_information&gt; # replace &lt;default_account_information&gt; with your account info\n\n## General Snakemake Settings\njobs: &lt;max_number_of_jobs&gt;                  # replace &lt;max_number_of_jobs&gt; with your desired maximum number of concurrent jobs, e.g., 10\nlatency-wait: &lt;latency_seconds&gt;             # replace &lt;latency_seconds&gt; with the number of seconds to wait if job output is not present, e.g., 120\nlocal-cores: &lt;local_core_count&gt;             # replace &lt;local_core_count&gt; with the max number of cores to use locally, e.g., \"20\"\nrestart-times: &lt;restart_attempts&gt;           # replace &lt;restart_attempts&gt; with the number of times to retry failing jobs, e.g., \"0\" for no retries\nmax-jobs-per-second: &lt;job_submission_rate&gt;  # replace &lt;job_submission_rate&gt; with the limit on how many jobs can be submitted per second, e.g., \"20\"\nkeep-going: &lt;continue_after_failure&gt;        # replace &lt;continue_after_failure&gt; with True or False to indicate whether to continue executing other jobs after a failure\nrerun-incomplete: &lt;rerun_incomplete_jobs&gt;   # replace &lt;rerun_incomplete_jobs&gt; with True or False to decide if incomplete jobs should be rerun\nprintshellcmds: &lt;print_commands&gt;            # replace &lt;print_commands&gt; with True or False to specify if shell commands should be printed before execution\n\n## Scheduler Settings\n#scheduler: greedy      \n\n## Conda Environment Settings\nuse-conda: &lt;True_or_False&gt;               # enable use of Conda environments\nconda-frontend: conda                    # specify Conda as the package manager frontend\n</code></pre>"},{"location":"installation/slurm/#a-cluster-configuration-file-for-snakemake-v860","title":"A Cluster Configuration file for Snakemake v8.6.0","text":"<p>Please first install the Snakemake executor plugin \"<code>cluster-generic</code>\":</p> <pre><code>pip install snakemake-executor-plugin-cluster-generic\n</code></pre> <p>Then, create the cluster configuration file with below. Please substitute the placeholders below, marked with <code>&lt;&gt;</code>, to suit your specific case. Please see our example file at slurm/v8.6.0/config.yaml. </p> <pre><code>## Cluster Configuration\n## The following setting also aids in organizing log files by creating rule-specific subdirectories within the job's log directory, each holding its own output and error files.\nexecutor: \"cluster-generic\"\ncluster-generic-submit-cmd: \"mkdir -p logs/{rule}/ &amp;&amp;\n  sbatch\n    --job-name={rule}_{wildcards} \\\n    --output=logs/{rule}/{rule}___{wildcards}___%j.out \\\n    --error=logs/{rule}/{rule}___{wildcards}___%j.err \\\n    --partition={resources.partition} \\\n    --mem={resources.mem} \\\n    --time={resources.time} \\\n    --cpus-per-task={threads} \\\n    --parsable \\\n    --nodes={resources.nodes} \"\n\n## Default Resources for Jobs\ndefault-resources:\n  - partition=&lt;your_default_partition&gt;    # replace &lt;your_default_partition&gt; with your actual partition name\n  - mem=&lt;default_memory_allocation&gt;       # replace &lt;default_memory_allocation&gt; with memory, e.g., \"4G\"\n  - time=&lt;default_time_limit&gt;             # replace &lt;default_time_limit&gt; with time, e.g., \"01:00:00\"\n  - nodes=&lt;default_number_of_nodes&gt;       # replace &lt;default_number_of_nodes&gt; with nodes, e.g., \"1\"\n  - account=&lt;default_account_information&gt; # replace &lt;default_account_information&gt; with your account info\n\n## General Snakemake Settings\njobs: &lt;max_number_of_jobs&gt;                  # replace &lt;max_number_of_jobs&gt; with your desired maximum number of concurrent jobs, e.g., 10\nlatency-wait: &lt;latency_seconds&gt;             # replace &lt;latency_seconds&gt; with the number of seconds to wait if job output is not present, e.g., 120\nlocal-cores: &lt;local_core_count&gt;             # replace &lt;local_core_count&gt; with the max number of cores to use locally, e.g., \"20\"\nrestart-times: &lt;restart_attempts&gt;           # replace &lt;restart_attempts&gt; with the number of times to retry failing jobs, e.g., \"0\" for no retries\nmax-jobs-per-second: &lt;job_submission_rate&gt;  # replace &lt;job_submission_rate&gt; with the limit on how many jobs can be submitted per second, e.g., \"20\"\nkeep-going: &lt;continue_after_failure&gt;        # replace &lt;continue_after_failure&gt; with True or False to indicate whether to continue executing other jobs after a failure\nrerun-incomplete: &lt;rerun_incomplete_jobs&gt;   # replace &lt;rerun_incomplete_jobs&gt; with True or False to decide if incomplete jobs should be rerun\nprintshellcmds: &lt;print_commands&gt;            # replace &lt;print_commands&gt; with True or False to specify if shell commands should be printed before execution\n\n## Conda Environment Settings\nsoftware-deployment-method: conda\n</code></pre>"},{"location":"installation/slurm/#additional-functions","title":"Additional functions","text":"<p>If you encounter situations where your jobs fail without any warnings, it is feasible to using a cluster status script to keep track of your jobs. See details here.</p>"},{"location":"walkthrough/intro/","title":"Introduction","text":"<p>This Walkthrough section serves as a comprehensive overview of NovaScope's functionality, featuring both a rule execution guide and specific rule instructions.</p> <p>The rule execution guide outlines essential concepts for operating NovaScope and offers a glimpse of the execution flows for various <code>request</code> options.</p> <p>Meanwhile, the specific rule instructions provide detailed information for each rule, including its purpose, inputs and outputs, tips for reviewing output, parameters, dependencies, and relevant code snippets. The output completes with descriptions, naming conventions, file formats, and visualisation for images. </p> <p>Info</p> <p>The walkthrough showcases the file format and visualization techniques applied to the results from the Shallow Liver Section Dataset.</p>"},{"location":"walkthrough/execution_guide/core_concepts/","title":"Core Concepts","text":"<p>Before the execution flow by <code>request</code>, below outlines essential concepts for working with NovaScope.</p>"},{"location":"walkthrough/execution_guide/core_concepts/#rule-dependencies","title":"Rule Dependencies","text":"<p>The rule dependencies are determined based on the input and output files specified in the rules. For example, if Rule <code>sbcd2chip</code> requires the output of Rule <code>fastq2sbcd</code> as input, the Rule <code>fastq2sbcd</code> serves as a prerequisite rule to Rule <code>sbcd2chip</code>. </p>"},{"location":"walkthrough/execution_guide/core_concepts/#execution-dynamics","title":"Execution Dynamics","text":"<p>The execution of rules within NovaScope is governed by several key factors, outlined as follows:</p> <ul> <li> <p>Specified Final Output Files: The execution of rules is directly influenced by the final output files requested by the user, as defined by the <code>Request</code> field in the job configuration file. For instance, if the output of a rule (referred to as <code>Rule X</code>) is indicated as the final output file, then <code>Rule X</code> will be executed.</p> </li> <li> <p>Rule Dependencies and Availability of Intermediate Files: NovaScope initiates a systematic evaluation, starting with <code>Rule X</code>, to ascertain the presence of its required input files. If any inputs are missing, NovaScope iteratively identifies and executes the necessary precursor rules to generate these missing inputs, thus ensuring <code>Rule X</code> has everything it needs to proceed.</p> </li> <li> <p>User-Defined Execution Options: Snakemake provides a suite of command-line arguments that allow users to tailor the execution process of the pipeline. Below includes a selection of frequently utilized execution options. For all available execution options and their functionalities, please consult the official Snakemake documentation.</p> <ul> <li><code>--rerun-incomplete</code> and <code>--ignore-incomplete</code>: These options dictate whether to rerun or ignore jobs that started but did not complete successfully in previous attempts.</li> <li><code>--restart-times</code>: This option sets the maximum number of attempts to restart a failing job before it is considered unsuccessful.</li> <li><code>--forceall</code>, <code>-F</code>: This option compels the execution of all rules, irrespective of their current completion status.</li> </ul> </li> </ul>"},{"location":"walkthrough/execution_guide/core_concepts/#rulegraph","title":"Rulegraph","text":"<p>A rulegraph visually maps the rules to be executed alongside their dependencies. </p> <ul> <li>Components: A rulegraph represents each rule as a node, with directed edges showing how the output of one rule serves as the input for another, establishing a clear path of data flow and execution order. </li> <li>Rule Status: Solid lines depict rules set to be executed, while dotted lines indicate rules that will be skipped, as their outputs are already up to date. </li> </ul> <p>By demonstrating the workflow's structure, highlighting the sequence in which tasks are performed and how they interconnect, a rulegraph help understand the entire process from start to finish.</p>"},{"location":"walkthrough/execution_guide/rule_execution/","title":"Execution Flow by Request","text":"<p>This page provides an overview of the rule execution flow tailored to different <code>request</code> specified in the job configuration file of NovaScope. </p> <p>Each <code>request</code> option triggers a specific set of rules. Thus, below provides a rulegraph for each <code>request</code> option to outline the triggered rules and their interdependencies, detailing distinct processing paths.</p> <p>Info</p> <p>The visual guides below are constructed from a baseline scenario where only the initial input 1st-seq and 2nd-seq FASTQ files are present, with no prior processing or intermediate files generated.</p>"},{"location":"walkthrough/execution_guide/rule_execution/#request-sbcd-per-flowcell","title":"Request <code>\"sbcd-per-flowcell\"</code>","text":"<ul> <li> <p>Description: The <code>\"sbcd-per-flowcell\"</code> option initiates the generation of a spatial barcode map specific to a flow cell. Consequently, it triggers the execution of Rule <code>fastq2sbcd</code>.</p> </li> <li> <p>Rule Graph:</p> </li> </ul>"},{"location":"walkthrough/execution_guide/rule_execution/#request-sbcd-per-chip","title":"Request <code>\"sbcd-per-chip\"</code>","text":"<ul> <li> <p>Description: The <code>\"sbcd-per-chip\"</code> option requests a spatial barcode map specific to a given section chip and a plot of the distribution of spatial barcodes, triggering the execution of Rule <code>sbcd2chip</code> and its prerequisite rule: <code>fastq2sbcd</code>.</p> </li> <li> <p>Rule Graph:</p> </li> </ul>"},{"location":"walkthrough/execution_guide/rule_execution/#request-smatch-per-chip","title":"Request <code>\"smatch-per-chip\"</code>","text":"<ul> <li> <p>Description: For each pair of input 2nd-seq FASTQ files associated with a given chip, the <code>\"smatch-per-chip\"</code> option demands two files, including a file of spatial barcodes matched to the 2nd-seq reads alongside its summary metrics, and an image depicting the spatial distribution of those matched barcodes. This request prompts the execution of Rule <code>smatch</code> and its prerequisite rules: <code>sbcd2chip</code> and <code>fastq2sbcd</code>.</p> </li> <li> <p>Rule Graph:</p> </li> </ul>"},{"location":"walkthrough/execution_guide/rule_execution/#request-align-per-run","title":"Request <code>\"align-per-run\"</code>","text":"<ul> <li> <p>Description: The <code>\"align-per-run\"</code> option request a Binary Alignment Map (BAM) from the alignment as well as the digital gene expression matrices (DGEs) for Gene, GeneFull, splice junctions (SJ), and Velocyto. It provokes the execution of Rule <code>align</code> and its prerequisite rules including <code>smatch</code>, <code>sbcd2chip</code>, and <code>fastq2sbcd</code>.</p> </li> <li> <p>Rule Graph:</p> </li> </ul>"},{"location":"walkthrough/execution_guide/rule_execution/#request-sge-per-run","title":"Request <code>\"sge-per-run\"</code>","text":"<ul> <li> <p>Description: The <code>\"sge-per-run\"</code> option inquires: 1) a spatial digital gene expression matrix (SGE) encompassing all genomic features with two plots visualizing the distribution of the aligned spatial barcodes; 2) visualization for genes of interest provided in the job configuration file. It requests the execution of Rule <code>dge2sdge</code> and <code>gene_visual</code>, alongside the prerequisite rules: <code>align</code>, <code>smatch</code>, <code>sbcd2chip</code>, and <code>fastq2sbcd</code>.</p> </li> <li> <p>Rule Graph:</p> </li> </ul>"},{"location":"walkthrough/execution_guide/rule_execution/#request-transcript-per-unit","title":"Request <code>\"transcript-per-unit\"</code>","text":"<ul> <li> <p>Description: The <code>\"transcript-per-unit\"</code> option requests a SGE in a FICTURE-compatible format. It requests the execution of Rule <code>sdgeAR_reformat</code>, alongside the prerequisite rules: <code>sdge2sdgeAR</code>, <code>dge2sdge</code>, <code>align</code>, <code>smatch</code>, <code>sbcd2chip</code>, and <code>fastq2sbcd</code>.</p> </li> <li> <p>Rule Graph:</p> </li> </ul>"},{"location":"walkthrough/execution_guide/rule_execution/#request-segment-per-unit","title":"Request <code>\"segment-per-unit\"</code>","text":"<ul> <li> <p>Description: The <code>\"segment-per-unit\"</code> option requests a hexagon-based SGE in the 10x genomics format. It requests the execution of Rule <code>sdgeAR_segment</code>, alongside the prerequisite rules: <code>sdgeAR_reformat</code>, <code>sdge2sdgeAR</code>, <code>dge2sdge</code>, <code>align</code>, <code>smatch</code>, <code>sbcd2chip</code>, and <code>fastq2sbcd</code>.</p> </li> <li> <p>Rule Graph:</p> </li> </ul>"},{"location":"walkthrough/rules/align/","title":"Rule <code>align</code>","text":""},{"location":"walkthrough/rules/align/#purpose","title":"Purpose","text":"<p>The purpose of the <code>align</code> rule is to map the reads from 2nd-seq FASTQ files to the reference genome, focusing on a per-chip approach. For a chip associated with multiple pairs of 2nd-seq FASTQ files, NovaScope executes the <code>align</code> rule once utilizing all file pairs.</p> <p>Specifically, the process involves 1) combining all FASTQ files from 2nd-seq that are related to this chip, 2) discarding any 2nd-seq reads from that do not possess a spatial barcode sequence (HDMI) identified in 1st-seq, 3) mapping 2nd-seq reads to the reference genome utilizing STARsolo.</p>"},{"location":"walkthrough/rules/align/#input-files","title":"Input Files","text":"<ul> <li> <p>2nd-seq FASTQ file All pairs of 2nd-seq FASTQ files that are associated to the given chip are designed as input.</p> </li> <li> <p>Matched Spatial Barcode Files Matched Spatial barcode files for all pairs of 2nd-seq FASTQ files, which are produced by Rule <code>smatch</code>.</p> </li> </ul>"},{"location":"walkthrough/rules/align/#output-files","title":"Output Files","text":"<p>The rule generates the following output in the specified directory path: <pre><code>&lt;output_directory&gt;/align/&lt;flowcell_id&gt;/&lt;chip_id&gt;/&lt;run_id&gt;/bam\n</code></pre></p>"},{"location":"walkthrough/rules/align/#1-a-binary-alignment-map-bam-file","title":"(1) A Binary Alignment Map (BAM) File","text":"<p>Description: A Binary Alignment Map (BAM) file contains the aligned reads, sorted by genomic coordinates. The BAM file is accompanied by a BAM index (BAI) file.</p> <p>File Naming Convention:</p> <ul> <li>The BAM file: <code>sttoolsAligned.sortedByCoord.out.bam</code></li> <li>The BAI file: <code>sttoolsAligned.sortedByCoord.out.bam.bai</code></li> </ul> <p>File Format: For detailed information on the file formats for BAM and BAI files, please refer to the Format Specification provided by Samtools.</p>"},{"location":"walkthrough/rules/align/#2-alignment-summary-metrics","title":"(2) Alignment summary metrics","text":"<p>Description: A table file containing metrics such as the total number of input reads, average length of input reads, and summary statistics for unique, multi-mapping, unmapped, and chimeric reads.</p> <p>File Naming Convention: <code>sttoolsLog.final.out</code></p> <p>File Format: <pre><code>                                 Started job on |       Apr 01 18:32:36\n                             Started mapping on |       Apr 01 18:33:47\n                                    Finished on |       Apr 01 18:51:55\n       Mapping speed, Million of reads per hour |       275.83\n\n                          Number of input reads |       83363295\n                      Average input read length |       68\n                                    UNIQUE READS:\n                   Uniquely mapped reads number |       44728786\n                        Uniquely mapped reads % |       53.66%\n                          Average mapped length |       86.51\n                       Number of splices: Total |       4221113\n            Number of splices: Annotated (sjdb) |       4108506\n                       Number of splices: GT/AG |       4174922\n                       Number of splices: GC/AG |       13282\n                       Number of splices: AT/AC |       581\n               Number of splices: Non-canonical |       32328\n                      Mismatch rate per base, % |       0.92%\n                         Deletion rate per base |       0.03%\n                        Deletion average length |       1.56\n                        Insertion rate per base |       0.01%\n                       Insertion average length |       1.20\n                             MULTI-MAPPING READS:\n        Number of reads mapped to multiple loci |       9853625\n             % of reads mapped to multiple loci |       11.82%\n        Number of reads mapped to too many loci |       1330676\n             % of reads mapped to too many loci |       1.60%\n                                  UNMAPPED READS:\n  Number of reads unmapped: too many mismatches |       0\n       % of reads unmapped: too many mismatches |       0.00%\n            Number of reads unmapped: too short |       4764703\n                 % of reads unmapped: too short |       5.72%\n                Number of reads unmapped: other |       22685505\n                     % of reads unmapped: other |       27.21%\n                                  CHIMERIC READS:\n                       Number of chimeric reads |       0\n                            % of chimeric reads |       0.00%\n</code></pre></p>"},{"location":"walkthrough/rules/align/#3-digital-gene-expression-matrices-dges","title":"(3) Digital Gene Expression Matrices (DGEs)","text":"<p>Description: A digital gene expression matrix (DGE) is generated for each genomic feature, including Gene, GeneFull, splice junctions (SJ), and Velocyto. The DGE for Gene counts reads match the gene transcript while the DGE for GeneFull counts all reads overlapping the exons and introns of the gene.</p> <p>File Naming Convention: For each genomic feature, a DGE, which is composed of <code>barcodes.tsv.gz</code>, <code>features.tsv.gz</code>, and <code>matrix.mtx.gz</code>, is stored in a directory named after the genomic feature.</p> <p>File Format:</p> <ul> <li> <p><code>barcodes.tsv.gz</code>: A single-column file with Unix line endings and no header, where each row lists a barcode. <pre><code>AAAAAAAATAGTTCTGCTAGCTGGTAAGCT\nAAAAAAAGTGATCAGAGGTGATATTATGCT\nAAAAAAAGTTCGCACTATACGAACAGGGAT\n</code></pre></p> </li> <li> <p><code>features.tsv.gz</code>: Each row includes the following three columns without header: feature ID (column 1), feature name (column 2), and type of feature (column 3). <pre><code>ENSMUSG00000100764  Gm29155 Gene Expression\nENSMUSG00000100635  Gm29157 Gene Expression\nENSMUSG00000100480  Gm29156 Gene Expression\n</code></pre></p> </li> <li> <p><code>matrix.tsv.gz</code>: A compressed sparse matrix file format storing non-zero gene expression values across spatial locations or barcodes in spatial transcriptomics data. <pre><code>%%MatrixMarket matrix coordinate integer general\n%\n33989 17641021 17801209\n9677 1 1\n20305 2 1\n23800 2 1\n</code></pre></p> <ul> <li><code>Header</code>: Initial lines form the header, declaring the matrix's adherence to the Market Matrix (MTX) format, outlining its traits. This section may include comments (lines beginning with <code>%</code>) for extra metadata, all marked by a \u201c%\u201d.</li> <li><code>Dimensions</code>: Following the header, the first line details the matrix dimensions: the count of rows (features), columns (barcodes), and non-zero entries.</li> <li><code>Data Entries</code>: Post-dimensions, subsequent lines enumerate non-zero entries in triplet form: row index (feature index), column index (barcode index), and value (expression level).</li> </ul> </li> </ul>"},{"location":"walkthrough/rules/align/#output-guidelines","title":"Output Guidelines","text":"<p>It is suggested to review the summary metrics to confirm the total read count, the percentage of reads aligned to genomes and genes, library saturation, the count of aligned spatial barcodes, and the count of unique transcripts.</p>"},{"location":"walkthrough/rules/align/#parameters","title":"Parameters","text":"<p>The following parameter in the job configuration file will be applied in this rule.</p> <pre><code>upstream:\n  smatch:                   \n    skip_sbcd: 1            \n    match_len: 27           \n  align:                    \n     min_match_len: 30      \n     min_match_frac: 0.66   \n     len_sbcd: 30            \n     len_umi: 9              \n     len_r2: 101             \n     exist_action: overwrite\n     resource:               \n       assign_type: stdin\n       stdin:\n         partition: standard\n         threads: 10\n         memory: 70000m\n</code></pre> <ul> <li> <p>Reformat FASTQ Paramaters</p> <p>Parameters in <code>smatch</code> and three parameters in <code>align</code> (including <code>len_sbcd</code>, <code>len_umi</code>, and <code>len_r2</code>) are used to pass values to the <code>reformat-fastqs</code> function in spatula. Below, for each parameter, the corresponding parameter in spatula, description, and the default value in NovaScope are provided.</p> Parameter <code>spatula</code> parameter Description Default Value <code>skip_sbcd</code> <code>--skip-sbcd</code> The number of initial bases to omit from the read. 1 <code>match_len</code> <code>--match-len</code> The length of the spatial barcode to be considered as a perfectmatch. 27 <code>len_sbcd</code> <code>--len_sbcd</code> The length of the spatial barcode sequence to be copied in Read 1 30 <code>len_umi</code> <code>--len_umi</code> The length of the UMI sequence (randomer) to be copied from Read 2 (beginning) to Read 1 (after spatial barcode) 9 <code>len_r2</code> <code>--len_r2</code> The length of Read 2 sequences to be trimmed 101 <ul> <li><code>skip_sbcd</code>: This is useful if the 1st-seq spatial barcode lacks sufficient bases. When absent in the job configuration file, NovaScope determines <code>skip_sbcd</code> following the <code>format</code> in <code>fastq2sbcd</code>: 1 for DraI31 and 0 for DraI32.</li> </ul> </li> <li> <p>Alignment Paramaters</p> <p>Four parameters in <code>align</code> (including <code>len_sbcd</code>, <code>len_umi</code>, <code>min_match_len</code>, and <code>min_match_frac</code>) are used to pass values to STARsolo. Below, for each parameter, the corresponding parameter in STARsolo, description, and the default value in NovaScope are provided.</p> Parameter <code>STARsolo</code> parameter Description Default Value <code>len_sbcd</code> <code>--soloCBlen</code> The cell barcode length 30 <code>--soloUMIstart</code> Defined as <code>len_sbcd + 1</code>, this indicates UMI sequence (randomer) start base. 31 <code>len_umi</code> <code>--soloUMIlen</code> The length of UMI sequence (randomer) start base. 9 <code>min_match_len</code> <code>--outFilterMatchNmin</code> An alignment is only output if the count of matched bases &gt;= this value. 30 <code>min_match_frac</code> <code>--outFilterMatchNminOverLread</code> Similar to <code>min_match_len</code>, normalized to the read length 0.66 </li> <li> <p>The <code>exist_action</code> Parameter</p> <p>The <code>exist_action</code> parameter within <code>align</code> provides two choices for handling existing intermediate or output files: \"<code>skip</code>\" tells NovaScope to bypass these files, whereas \"<code>overwrite</code>\" instructs NovaScope to replace them.</p> </li> <li> <p>The <code>resource</code> Parameter</p> <p>The <code>resource</code> parameters, specific to HPC users, determine the partitions, CPU count, and memory allocation for the alignment process. Details for the <code>resource</code> parameters in <code>align</code> are provided in the <code>upstream</code> parameters in Job Configuration.</p> </li> </ul>"},{"location":"walkthrough/rules/align/#dependencies","title":"Dependencies","text":"<p>Rule <code>align</code> requires the matched spatial barcode files from Rule <code>smatch</code> generates. Hence, if the input files are not available, <code>align</code> relies on the successful completion of <code>smatch</code> for proper operation. See an overview of the rule dependencies in the Workflow Structure.</p>"},{"location":"walkthrough/rules/align/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in a04_align.smk</p>"},{"location":"walkthrough/rules/dge2sdge/","title":"Rule <code>dge2sdge</code>:","text":""},{"location":"walkthrough/rules/dge2sdge/#purpose","title":"Purpose","text":"<p>The <code>dge2sdge</code> generates a spatial digital gene expression matrix (SGE) using the digital gene expression matrix (DGE) from alignment and spatial maps.</p>"},{"location":"walkthrough/rules/dge2sdge/#input-files","title":"Input Files","text":"<ul> <li>Per-Chip Spatial Barcode Map and Manifest File Required input files include the spatial barcode map and manifest file for the chip of interest, which are created by the <code>sbcd2chip</code> rule.</li> <li>Per-Chip Matched Spatial Barcode Files It also requires matched spatial barcode files that contains spatial barcodes matched to the 2nd-seq reads. Those files are generated by the <code>smatch</code> rule.</li> <li>DGEs DGEs for each genomic feature, including Gene, GeneFull, splice junctions (SJ), and Velocyto, are produced by the <code>align</code> rule.</li> </ul>"},{"location":"walkthrough/rules/dge2sdge/#output-files","title":"Output Files","text":"<p>The rule generates the following output in the specified directory path: <pre><code>&lt;output_directory&gt;/align/&lt;flowcell_id&gt;/&lt;chip_id&gt;/&lt;run_id&gt;/sge\n</code></pre></p>"},{"location":"walkthrough/rules/dge2sdge/#1-spatial-digital-gene-expression-matrix-sge","title":"(1) Spatial Digital Gene Expression Matrix (SGE)","text":"<p>Description: A spatial digital gene expression matrix (SGE) in 10x Genomics format is generated, which contains all available genomic feature. </p> <p>File Naming Convention: The SGE is composed of <code>barcodes.tsv.gz</code>, <code>features.tsv.gz</code>, and <code>matrix.mtx.gz</code>. </p> <p>File Format:</p> <ul> <li> <p><code>barcodes.tsv.gz</code>: <pre><code>AAAAAAGGTACCCGCAGTGCGGACAAACGA  1   1   1   1   1214343 1498113 1,1,1,0,0\nAAAACAGGAGATTCAGAATGCAAAAATGAA  2   2   1   1   1029766 1669474 0,1,0,1,0\nAAAACTTGTCGAGCTCAGTGACGCGGGCTT  3   3   1   1   1366819 1170486 2,2,1,0,1\n</code></pre></p> <ul> <li>Column 1: sorted spatial barcodes</li> <li>Column 2: 1-based integer index of the spatial barcode</li> <li>Column 3: 1-based integer index from the full barcode that is in the STARsolo output</li> <li>Column 4: Lane ID, which is defined as <code>1</code>.</li> <li>Column 5: Tile ID, which is defined as <code>1</code>.</li> <li>Column 6: X-coordinate within the chip (global X-coordinate).</li> <li>Column 7: Y-coordinate within the chip (global Y-coordinate).</li> <li>Column 8: Five comma-separated numbers denote the count per spatial barcode for each genomic feature, in the order of Gene, GeneFull, Spliced, Unspliced, and Ambiguous.</li> </ul> </li> <li> <p><code>features.tsv.gz</code>: <pre><code>ENSMUSG00000100764  Gm29155 1   2,2,1,0,1\nENSMUSG00000100635  Gm29157 2   0,0,0,0,0\nENSMUSG00000100480  Gm29156 3   0,0,0,0,0\n</code></pre></p> <ul> <li>Column 1: Gene Ensemble ID</li> <li>Column 2: Gene symbol</li> <li>Column 3: 1-based integer index which will be used in matrix.mtx.gz</li> <li>Column 4: Five comma-separated numbers denote the count per gene for each genomic feature, in the order of Gene, GeneFull, Spliced, Unspliced, and Ambiguous.</li> </ul> </li> <li> <p><code>matrix.mtx.gz</code>: <pre><code>%%MatrixMarket matrix coordinate integer general\n%\n33989 1197304 2488321\n5743 1 1 1 1 0 0\n6002 2 0 1 0 1 0\n7279 3 1 1 1 0 0\n</code></pre></p> <ul> <li><code>Header</code>: Initial lines form the header, declaring the matrix's adherence to the Market Matrix (MTX) format, outlining its traits. This may include comments (lines beginning with <code>%</code>) for extra metadata, all marked by a \u201c%\u201d.</li> <li><code>Dimensions</code>: Following the header, the first line details the matrix dimensions: the count of rows (features), columns (barcodes), and non-zero entries.</li> <li><code>Data Entries</code>: Post-dimensions, subsequent lines enumerate non-zero entries in seven columns: row index (feature index), column index (barcode index), and five values (expression levels) corresponds to Gene, GeneFull, Spliced, Unspliced, and Ambiguous.</li> </ul> </li> </ul>"},{"location":"walkthrough/rules/dge2sdge/#2-an-sge-image","title":"(2) An \"sge\" image","text":"<p>Description: The \"sge\" image illustrates the distribution of spatial barcodes aligned to the reference genome, with exon-aligned transcripts colored red, unspliced transcripts green, and mitochondrial transcripts blue.</p> <p>File Naming Convention: <pre><code>&lt;run_id&gt;.gene_full_mito.png\n</code></pre></p> <p>File Visualization:</p>"},{"location":"walkthrough/rules/dge2sdge/#3-a-comprehensive-view-of-sbcd-smatch-and-sge-images","title":"(3) A Comprehensive View of \"sbcd\", \"smatch\", and \"sge\" Images","text":"<p>Description: A side-by-side presentation of three images: the \"sbcd\" image from <code>sbcd2chip</code>, the \"smatch\" image from <code>smatch</code>, and the \"sge\" image generated by the current rule.</p> <p>File Naming Convention: <pre><code>&lt;run_id&gt;.sge_match_sbcd.png\n</code></pre></p> <p>File Visualization:</p>"},{"location":"walkthrough/rules/dge2sdge/#4-a-metadata-file-for-x-y-coordinates","title":"(4) A Metadata File for X Y Coordinates","text":"<p>Description: This file contains the minimum and maximum X Y coordinates, which are essential for the reformatting features.</p> <p>File Naming Convention: <pre><code>barcodes.minmax.tsv\n</code></pre></p> <p>File Format: <pre><code>xmin  xmax      ymin  ymax\n0     12810899  0     6950609\n</code></pre></p> <ul> <li><code>xmin</code>: The minimum x-coordinate in nanometers across all barcodes in the SGE.</li> <li><code>xmax</code>: The maximum x-coordinate in nanometers across all barcodes in the SGE.</li> <li><code>ymin</code>: The minimum y-coordinate in nanometers across all barcodes in the SGE.</li> <li><code>ymax</code>: The maximum y-coordinate in nanometers across all barcodes in the SGE.</li> </ul>"},{"location":"walkthrough/rules/dge2sdge/#output-guidelines","title":"Output Guidelines","text":"<p>It is suggested to review the \"sge\" image along with the composite image displaying \"sbcd\", \"smatch\", and \"sge\" images together, to confirm: 1) that the \"sge\" image's spatial distribution of aligned transcripts corresponds with the tissue area, and 2) there is coherence among the \"smatch\", and \"sge\" images.</p>"},{"location":"walkthrough/rules/dge2sdge/#parameters","title":"Parameters","text":"<pre><code>upstream:\n  dge2sdge:\n    layout: null\n</code></pre> <ul> <li>The <code>layout</code> Parameter The applies as the layout for the RGB plots. When absent, NovaScope use the predefined layout file.</li> </ul>"},{"location":"walkthrough/rules/dge2sdge/#dependencies","title":"Dependencies","text":"<p>Given the input from Rule <code>sbcd2chip</code>, <code>smatch</code>, and <code>align</code> serve as the necessary input for <code>dge2sdge</code>. This linkage ensures Rule <code>dge2sdge</code> can only execute after <code>sbcd2chip</code>, <code>smatch</code>, and <code>align</code> have successfully completed their operations. See an overview of the rule dependencies in the Workflow Structure.</p>"},{"location":"walkthrough/rules/dge2sdge/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in <code>a05_dge2sdge.smk</code>.</p>"},{"location":"walkthrough/rules/fastq2sbcd/","title":"Rule <code>fastq2sbcd</code>","text":""},{"location":"walkthrough/rules/fastq2sbcd/#purpose","title":"Purpose","text":"<p>The <code>fastq2sbcd</code> rule aims to generate a spatial barcode map per-tile basis for an input 1st-seq FASTQ file.</p>"},{"location":"walkthrough/rules/fastq2sbcd/#input-files","title":"Input Files","text":"<p>The only input file required by <code>fastq2sbcd</code> is the 1st-seq FASTQ file. Ensure the raw FASTQ files are correctly formatted and listed in the job configuration file.</p>"},{"location":"walkthrough/rules/fastq2sbcd/#output-files","title":"Output Files","text":"<p>The rule generates the following output in the specified directory path:  <pre><code>&lt;output_directory&gt;/seq1st/&lt;flowcell_id&gt;/sbcds/&lt;seq1st_id&gt;\n</code></pre></p>"},{"location":"walkthrough/rules/fastq2sbcd/#1-per-tile-spatial-barcode-maps","title":"(1) Per-Tile Spatial Barcode Maps","text":"<p>Description: The spatial barcode map for each tile is stored in a zipped, tab-separated file. These files map the barcodes to their coordinates within the tile, facilitating easier matching with 2nd-Seq sequences through reverse-complemented barcodes.</p> <p>File Naming Convention:  <code>&lt;lane_id&gt;_&lt;tile_id&gt;.sbcds.sorted.tsv.gz</code></p> <p>File Format: The format of the spatial barcode map is outlined below with an example:</p> <pre><code>AAAAAAAAAAAAGCGACCGGGTAATATATGT 3   2456    1036    35446   1\nAAAAAAGGTACCCGCAGTGCGGACAAACGAA 3   2456    23448   29731   1\nAAAAAGACGAGTAAAAGTGACTGTTAATTAC 3   2456    29794   1799    1\n</code></pre> <ul> <li>Column 1: Spatial barcode sequence (HDMI, typically 32 base pairs).</li> <li>Column 2: Lane ID.</li> <li>Column 3: Tile ID.</li> <li>Column 4: X-coordinate within the tile (local X-coordinate).</li> <li>Column 5: Y-coordinate within the tile (local Y-coordinate).</li> <li>Column 6: Count of occurrences for each spatial barcode.</li> </ul>"},{"location":"walkthrough/rules/fastq2sbcd/#2-flow-cell-manifest","title":"(2) Flow Cell Manifest","text":"<p>Description: The manifest file provides summary statistics for each tile within the input FASTQ file, with each tile's statistics presented in a separate row.</p> <p>File Naming Convention: <code>manifest.tsv</code> </p> <p>File Format:</p> <pre><code>id      filepath                        barcodes    matches mismatches  xmin    xmax    ymin    ymax\n3_2456  3_2456.sbcds.sorted.tsv.gz      3460541     3377518 83023       1027    32949   1000    37059\n3_2556  3_2556.sbcds.sorted.tsv.gz      3416413     3334054 82359       1036    32958   1000    37059\n</code></pre> <ul> <li><code>id</code>: The <code>id</code> is composed of <code>&lt;lane_id&gt;_&lt;tile_id&gt;</code>.</li> <li><code>filepath</code>: The file name is the corresponding spatial barcode map.</li> <li><code>barcodes</code>: The number of barcodes in the tile.</li> <li><code>matches</code>: The number of barcodes match to the expected pattern.</li> <li><code>mismatches</code>: The number of barcodes don't match to the expected pattern.</li> <li><code>xmin</code>: The minimum X-coordinate across all barcodes within the tile (i.e., mimimum local X-coordinate).</li> <li><code>xmax</code>: The maximum X-coordinate across all barcodes within the tile (i.e., maximum local X-coordinate).</li> <li><code>ymin</code>: The minimum Y-coordinate across all barcodes within the tile (i.e., mimimum local Y-coordinate).</li> <li><code>ymax</code>: The maximum Y-coordinate across all barcodes within the tile (i.e., maximum local Y-coordinate).</li> </ul>"},{"location":"walkthrough/rules/fastq2sbcd/#output-guidelines","title":"Output Guidelines","text":"<p>For accuracy purposes, it's recommended to examine the <code>manifest.tsv</code> file to verify:</p> <ol> <li>A full lane typically comprises 936 tiles, with each tile having 3 million or more reads;</li> <li>The majority of reads are expected to align with the anticipated HDMI patterns.</li> </ol>"},{"location":"walkthrough/rules/fastq2sbcd/#parameters","title":"Parameters","text":"<p>The following parameter in the job configuration file will be applied in this rule. </p> <pre><code>upstream:\n  fastq2sbcd:\n    format: DraI32 \n</code></pre> <ul> <li>The <code>format</code> Parameter This parameter specifies the HDMI-oligo seed library used. The default setting is DraI32, which corresponds to HDMI32-DraI. Please see details for the seed HDMI-oligo library in the original publication of SeqScope.</li> </ul>"},{"location":"walkthrough/rules/fastq2sbcd/#dependencies","title":"Dependencies","text":"<p>Rule <code>fastq2sbcd</code> operates independently without dependencies on preceding rules. An overview of the rule dependencies are provided in the Workflow Structure.</p>"},{"location":"walkthrough/rules/fastq2sbcd/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in <code>a01_fastq2sbcd.smk</code>.</p>"},{"location":"walkthrough/rules/historef/","title":"Rule <code>historef</code>","text":""},{"location":"walkthrough/rules/historef/#purpose","title":"Purpose","text":"<p>The goal of <code>historef</code> rule is to match the histology image with the spatial coordinates of the spatial digital gene expression matrix (SGE). This is achieved by aligning fiducial markers observable in both the histology image and the composite image of \"sbcd\", \"smatch\", and \"sge\" images.</p>"},{"location":"walkthrough/rules/historef/#input-files","title":"Input Files","text":"<ul> <li> <p>A histology image Th histology image with fiducial markers is required. The <code>historef</code> identifies fiducial marks by detecting the brightness in the input histology image, so it is crucial that fiducial markers are the brightest area in the histology image.</p> </li> <li> <p>The composite image The composite image, which shows \"sbcd\", \"smatch\", and \"sge\" images side-by-side, will also be applied to <code>historef</code>.</p> </li> </ul>"},{"location":"walkthrough/rules/historef/#output-files","title":"Output Files","text":"<p>The rule generates the following output in the specified directory path: <pre><code>&lt;output_directory&gt;/histology/&lt;flowcell_id&gt;/&lt;chip_id&gt;/aligned/&lt;run_id&gt;\n</code></pre></p>"},{"location":"walkthrough/rules/historef/#1-a-referenced-histology-file","title":"(1) A referenced Histology File","text":"<p>Description: The referenced histology file, which is in GeoTIFFformat, allows the coordinate transformation between the SGE matrix and the input histology image.</p> <p>File Naming Convention:</p> <pre><code>&lt;histology_resolution&gt;X&lt;flowcell_abbreviation&gt;-&lt;chip_id&gt;-&lt;species&gt;-&lt;histology_figtype&gt;.tif\"\n</code></pre> <ul> <li>The <code>histology_resolution</code> and <code>histology_figtype</code> are derived from the <code>resolution</code> and <code>figtype</code> fields within the <code>histology</code> section of the job configuration file.</li> <li>The <code>flowcell_abbreviation</code> is derived by splitting the <code>flowcell_id</code>, which is sourced from the <code>flowcell</code> field in <code>input</code> section of the job configuration file, by \"-\" and taking the first part.</li> </ul> <p>File Visualization:</p> <p>The image displayed above only serves an initial glimpse into the results but has been substantially reduced in size and is presented in PNG format.</p> <p>For an in-depth examination, access the full-size referenced histology file within the <code>B08Cshallow_20240319_SGE_withHE.tar.gz</code> tarball.</p>"},{"location":"walkthrough/rules/historef/#2-a-re-sized-referenced-histology-file","title":"(2) A Re-sized Referenced Histology File","text":"<p>Description: An TIFF file shares the identical dimensions with both the \"smatch\" image and the \"sge\" image, acilitating the comparison of consistency between the histology file and these images.</p> <p>File Naming Convention:</p> <pre><code>&lt;histology_resolution&gt;X&lt;flowcell_abbreviation&gt;-&lt;chip_id&gt;-&lt;species&gt;-&lt;histology_figtype&gt;-fit.tif\"\n</code></pre> <ul> <li>The <code>histology_resolution</code> and <code>histology_figtype</code> are derived from the <code>resolution</code> and <code>figtype</code> fields within the <code>histology</code> section of the job configuration file.</li> <li>The <code>flowcell_abbreviation</code> is derived by splitting the <code>flowcell_id</code>, which is sourced from the <code>flowcell</code> field in <code>input</code> section of the job configuration file, by \"-\" and taking the first part.</li> </ul> <p>File Visualization:</p> <p>The full-size TIFF is provided in the <code>B08Cshallow_20240319_SGE_withHE.tar.gz</code>.</p>"},{"location":"walkthrough/rules/historef/#output-guidelines","title":"Output Guidelines","text":"<p>To verify the accuracy of the alignment, it is recommended to compare the re-sized referenced histology file against the \"smatch\" image and the \"sge\" image, ensuring a precise match with the histology images. A clear visibility of fiducial marks in both images indicates an accurate match with submicrometer resolution upon overlay. If the fiducial marks are insufficiently visible or aligned incorrectly, manual adjustment of the histology images is required.</p>"},{"location":"walkthrough/rules/historef/#parameters","title":"Parameters","text":"<p>The following parameter in the job configuration file will be applied in this rule.</p> <pre><code>histology:\n    resolution: 10\n    figtype: \"hne\"\n</code></pre> <ul> <li>The <code>histology</code> Parameters     The <code>resolution</code> and <code>figtype</code> indicates the resolution and type of the input histology file. The <code>historef</code> currently support the following types:<ul> <li><code>\"hne\"</code>: Hematoxylin and Eosin (H&amp;E) stained histology images;</li> <li><code>\"dapi\"</code>: DAPI or 4',6-diamidino-2-phenylindole stained histology images;</li> <li><code>\"fl\"</code>: Fluorescence stained histology images.</li> </ul> </li> </ul>"},{"location":"walkthrough/rules/historef/#dependencies","title":"Dependencies","text":"<p>Rule <code>historef</code> commences only after Rule <code>dge2sdge</code> has successfully executed. An overview of the rule dependencies are provided in the Workflow Structure.</p>"},{"location":"walkthrough/rules/historef/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in b02_historef.smk</p>"},{"location":"walkthrough/rules/sbcd2chip/","title":"Rule <code>sbcd2chip</code>","text":""},{"location":"walkthrough/rules/sbcd2chip/#purpose","title":"Purpose","text":"<p>The <code>sbcd2chip</code> rule is designed to create a spatial barcode map for a chip section of interest. It achieves this by merging the spatial maps of all tiles corresponding to the chip, guided by a spatial barcode layout file.</p>"},{"location":"walkthrough/rules/sbcd2chip/#input-files","title":"Input Files","text":"<ul> <li> <p>Per-Tile Spatial Barcode Maps &amp; Flow Cell Manifest Required inputs are the spatial barcode maps for each tile associated with the chip of interest and the manifest file for the corresponding flow cell. Both inputs are generated by the <code>fastq2sbcd</code> rule.</p> </li> <li> <p>A Spatial Barcode Layout file It is optional to provide a specific spatial barcode layout file for the chip via the job configuration file. If absent, NovaScope will use the spatial barcode layout provided by the NovaScope repository. </p> </li> </ul>"},{"location":"walkthrough/rules/sbcd2chip/#output-files","title":"Output Files","text":"<p>The rule generates the following output in the specified directory path:  <pre><code>&lt;output_directory&gt;/seq1st/&lt;flowcell_id&gt;/nbcds/&lt;seq1st_id&gt;\n</code></pre></p>"},{"location":"walkthrough/rules/sbcd2chip/#1-per-chip-spatial-barcode-mape","title":"(1) Per-Chip Spatial Barcode Mape","text":"<p>Description: This is a compressed, tab-delimited file mapping barcodes to global spatial coordinates on the chip, with duplicate barcodes removed. Note that only one spatial barcode map is produced for a chip, both lane ID and tile ID are set to <code>1</code>.</p> <p>File Naming Convention: <code>1_1.sbcds.sorted.tsv.gz</code></p> <p>File Format: </p> <pre><code>AAAAAAAAAAAAGCGACCGGGTAATATATGT 1   1   1413111 2277603 1\nAAAAAACATAAGAAAGATCCAAATGACGGTC 1   1   871865  383588  1\nAAAAAAGGTACCCGCAGTGCGGACAAACGAA 1   1   1214343 1498113 1\n</code></pre> <ul> <li>Column 1: Spatial barcode sequence (HDMI, typically 32 base pairs).</li> <li>Column 2: Lane ID, which is defined as <code>1</code>.</li> <li>Column 3: Tile ID, which is defined as <code>1</code>.</li> <li>Column 4: X-coordinate within the chip (global X-coordinate).</li> <li>Column 5: Y-coordinate within the chip (global Y-coordinate).</li> <li>Column 6: Count of occurrences for each spatial barcode.</li> </ul>"},{"location":"walkthrough/rules/sbcd2chip/#2-per-chip-manifest-file","title":"(2) Per-Chip Manifest File","text":"<p>Description: The manifest file offers summary statistics for the chip of interest. </p> <p>File Naming Convention: <code>manifest.tsv</code> </p> <p>File Format:  <pre><code>id   filepath                 barcodes  matches  mismatches  xmin  xmax     ymin  ymax\n1_1  1_1.sbcds.sorted.tsv.gz  5962994   5962994  0           0     1469211  0     2277916\n</code></pre></p> <ul> <li><code>id</code>: The <code>id</code> is composed of <code>&lt;lane_id&gt;_&lt;tile_id&gt;</code>. Given only one spatial barcode map is created for a chip, the ID is designed as <code>1_1</code>.</li> <li><code>filepath</code>: The file name is the corresponding spatial barcode map.</li> <li><code>barcodes</code>: The number of barcodes in the chip.</li> <li><code>matches</code>: The number of barcodes that match to the expected pattern.</li> <li><code>mismatches</code>: The number of barcodes that do not match to the expected pattern.</li> <li><code>xmin</code>: The minimum x-coordinate in nanometers across all barcodes in the chip (i.e., minimum global X-coordinate).</li> <li><code>xmax</code>: The maximum x-coordinate in nanometers across all barcodes in the chip (i.e., maximum global X-coordinate).</li> <li><code>ymin</code>: The minimum y-coordinate in nanometers across all barcodes in the chip (i.e., minimum global Y-coordinate).</li> <li><code>ymax</code>: The maximum y-coordinate in nanometers across all barcodes in the chip (i.e., maximum global Y-coordinate).</li> </ul>"},{"location":"walkthrough/rules/sbcd2chip/#3-an-sbcd-image","title":"(3) An \"sbcd\" Image","text":"<p>Description: An image to show the distribution of the spatial coordinates of the barcodes, alongside the fiducial marks.</p> <p>File Naming Convention: <code>1_1.sbcds.sorted.png</code> </p> <p>File Visualization:</p>"},{"location":"walkthrough/rules/sbcd2chip/#4-a-summary-for-duplicate-barcodes","title":"(4) A Summary for Duplicate Barcodes","text":"<p>Description:  Each duplicate barcode reports its count and the maximum distance between duplicates, provided it falls within the <code>dup_maxdist</code> threshold.</p> <p>File Naming Convention: <code>dupstats.tsv.gz</code></p>"},{"location":"walkthrough/rules/sbcd2chip/#output-guidelines","title":"Output Guidelines","text":"<p>Recommended review steps: 1. Examine <code>manifest.tsv</code> to ensure there are a sufficient number of matched barcodes, and all mismatched barcodes are removed. 2. Inspect <code>1_1.sbcds.sorted.png</code> to verify that fiducial marks appear empty and align with other fiducial marks both horizontally and vertically.</p>"},{"location":"walkthrough/rules/sbcd2chip/#parameters","title":"Parameters","text":"<p>The following parameter in the job configuration file will be applied in this rule. </p> <pre><code>upstream:\n  sbcd2chip:\n    gap_row: 0.0517\n    gap_col: 0.0048\n    dup_maxnum: 1\n    dup_maxdist: 1\n  visualization:\n    drawxy:\n      coord_per_pixel: 1000\n      intensity_per_obs: 50\n      icol_x: 3\n      icol_y: 4\n</code></pre> <ul> <li> <p>The <code>sbcd2chip</code> Parameters     Those parameters are used to pass values to the <code>combine_sbcds</code> function in spatula. Below, for each parameter, the corresponding parameters in spatula, description, and the default value in NovaScope are provided.</p> Parameter <code>spatula</code> parameter Description Default Value <code>gap_row</code> <code>--rowgap</code> Extra gap between rows, based on tile height, for spatial adjustment. 0.0517 <code>gap_col</code> <code>--colgap</code> Additional gap between columns, based on tile width, for spatial adjustment. 0.0048 <code>dup_maxnum</code> <code>--max-dup</code> Allowable duplicate count for each barcode, within <code>dup_maxdist</code>. 1 <code>dup_maxdist</code> <code>--max-dup-dist-nm</code> Max distance for duplicates, in nanometers. 1000 </li> <li> <p>The <code>visualization</code> Parameters     Those are parameters for the <code>draw-xy</code> function in spatula.</p> Parameter <code>spatula</code> parameter Description Default Value <code>coord_per_pixel</code> <code>--coord-per-pixel</code> Coordinates per pixel, as a divisor of input coordinate. 1000 <code>intensity_per_obs</code> <code>--intensity-per-obs</code> Intensity of points per pixel, max 255. 50 <code>icol_x</code> <code>--icol-x</code> (0-based) index of X coordinate in input TSV. 3 <code>icol_y</code> <code>--icol-y</code> (0-based) index of Y coordinate in input TSV. 4 </li> </ul>"},{"location":"walkthrough/rules/sbcd2chip/#dependencies","title":"Dependencies","text":"<p>Rule <code>sbcd2chip</code> is designed to process data that Rule <code>fastq2sbcd</code> generates. Therefore, if the input files are not available, <code>sbcd2chip</code> depends on the successful execution of <code>fastq2sbcd</code> to function correctly. An overview of the rule dependencies are provided in the Workflow Structure.</p>"},{"location":"walkthrough/rules/sbcd2chip/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in a02_sbcd2chip.smk</p>"},{"location":"walkthrough/rules/sdge2sdgeAR/","title":"Rule <code>sdge2sdgeAR</code>:","text":""},{"location":"walkthrough/rules/sdge2sdgeAR/#purpose","title":"Purpose","text":"<p>The <code>dge2sdgeAR</code> rule is designed to facilitate the utilization of the spatial digital gene expression matrix(SGE) in NovaScope's reformatting features. The main function of Rule <code>dge2sdgeAR</code> is creating a link from the original SGE located at <code>&lt;output_directory&gt;/align/&lt;flowcell_id&gt;/&lt;chip_id&gt;/&lt;run_id&gt;/sge</code> to the directory <code>&lt;output_directory&gt;/analysis/&lt;run_id&gt;/&lt;unit_id&gt;/sgeAR</code>. </p> <p>The use of the <code>sgeAR</code> subfolder instead of the direct <code>sge</code> directory allows for any necessary manual preprocessing of the SGE before reformatting. For more details, see The <code>sgeAR</code> Subfolder and Manual Preprocess.</p>"},{"location":"walkthrough/rules/sdge2sdgeAR/#input-files","title":"Input Files","text":"<ul> <li>Spatial Digital Gene Expression Matrix (SGE) and relevant files Required input files include a SGE, its related visualizations, and the meta file for X Y coordinates, which are created by Rule <code>dge2sdge</code>.</li> </ul>"},{"location":"walkthrough/rules/sdge2sdgeAR/#output-files","title":"Output Files","text":"<p>The rule generates the following output in the specified directory path: <pre><code>&lt;output_directory&gt;/analysis/&lt;run_id&gt;/&lt;unit_id&gt;/sgeAR\n</code></pre></p> <p>These output files are identical to those produced by the <code>dge2sdge</code> rule, as <code>dge2sdgeAR</code> does not modify the files but merely relocates them for easier access and further processing.</p>"},{"location":"walkthrough/rules/sdge2sdgeAR/#output-guidelines","title":"Output Guidelines","text":"<p>No action is required.</p>"},{"location":"walkthrough/rules/sdge2sdgeAR/#dependencies","title":"Dependencies","text":"<p>Given the input from Rule <code>dge2sdge</code> serve as the input for <code>sdge2sdgeAR</code>, Rule <code>sdge2sdgeAR</code> can only execute if the input SGE is available or the dependent rules have successfully completed their operations. See an overview of the rule dependencies in the Workflow Structure.</p>"},{"location":"walkthrough/rules/sdge2sdgeAR/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in <code>a06_sdge2sdgeAR.smk</code>.</p>"},{"location":"walkthrough/rules/sdgeAR_reformat/","title":"Rule <code>sdgeAR_reformat</code>:","text":""},{"location":"walkthrough/rules/sdgeAR_reformat/#purpose","title":"Purpose","text":"<p>The <code>sdgeAR_reformat</code> prepares the spatial digital gene expression matrix (SGE) in FICTURE-compatible format. This rule also offers gene-filtering function, when preparing the FICTURE-compatible SGE, depends on the user-defined parameters in the job configuration file.</p>"},{"location":"walkthrough/rules/sdgeAR_reformat/#input-files","title":"Input Files","text":"<ul> <li>Spatial Digital Gene Expression Matrix (SGE) and its Metadata File for Coordinates Required input files include a SGE file and its meta file for X Y coordinates. Those files are required to be stored in the <code>sgeAR</code> subfolder in the <code>analysis</code> directory. This could be generated by Rule <code>sdge2sdgeAR</code> or manually prepared by the users.</li> </ul>"},{"location":"walkthrough/rules/sdgeAR_reformat/#output-files","title":"Output Files","text":"<p>The rule generates the following output in the specified directory path: <pre><code>&lt;output_directory&gt;/analysis/&lt;run_id&gt;/&lt;unit_id&gt;/preprocess\n</code></pre></p>"},{"location":"walkthrough/rules/sdgeAR_reformat/#1-ficture-compatible-sge","title":"(1) FICTURE-compatible SGE","text":"<p>Description: A SGE in the FICTURE format is generated, which contains all informations including the barcode information, features information, and count for each genomic feature. </p> <p>File Naming Convention:  <pre><code>&lt;unit_id&gt;.merged.matrix.tsv.gz\n</code></pre></p> <p>File Format: <pre><code>#lane  tile  X      Y        gene_id             gene    gn  gt  spl  unspl  ambig\n1      1     5982   1439022  ENSMUSG00000029368  Alb     1   1   1    0      0\n1      1     8173   6863206  ENSMUSG00000053907  Mat2a   1   1   0    0      0\n1      1     8729   6830792  ENSMUSG00000037071  Scd1    1   1   1    0      0\n</code></pre></p> <ul> <li><code>#lane</code>: lane ID</li> <li><code>tile</code>: tile ID</li> <li><code>X</code>: X-coordinate</li> <li><code>Y</code>: Y-coordinate</li> <li><code>gene_id</code>: Gene Ensemble ID</li> <li><code>gene</code>: Gene symbol</li> <li><code>gn</code>: the count per gene per barcode for Gene</li> <li><code>gt</code>: the count per gene per barcode for GeneFull</li> <li><code>spl</code>: the count per gene per barcode for Spliced</li> <li><code>unspl</code>: the count per gene per barcode for Unspliced</li> <li><code>ambig</code>: the count per gene per barcode for Ambiguous</li> </ul>"},{"location":"walkthrough/rules/sdgeAR_reformat/#2-two-tab-delimited-feature-files","title":"(2) Two Tab-delimited Feature Files","text":"<p>Description: This include a feature file (<code>*.feature.tsv.gz</code>) that contains information for all features and another feature file (<code>*.feature.clean.tsv.gz</code>) that contains information for features aftering the gene-filtering.</p> <p>File Naming Convention: <pre><code>&lt;unit_id&gt;.feature.tsv.gz \n&lt;unit_id&gt;.feature.clean.tsv.gz\n</code></pre></p> <p>File Format: Those two feature files share the same format:</p> <pre><code>gene_id             gene     gn    gt   spl  unspl  ambig\nENSMUSG00000100764  Gm29155  3     3    1    0      2\nENSMUSG00000100635  Gm29157  0     0    0    0      0\nENSMUSG00000100480  Gm29156  0     0    0    0      0\n</code></pre> <ul> <li><code>gene_id</code>: Gene Ensemble ID</li> <li><code>gene</code>: Gene symbol</li> <li><code>gn</code>: the count per gene per barcode for Gene</li> <li><code>gt</code>: the count per gene per barcode for GeneFull</li> <li><code>spl</code>: the count per gene per barcode for Spliced</li> <li><code>unspl</code>: the count per gene per barcode for Unspliced</li> <li><code>ambig</code>: the count per gene per barcode for Ambiguous</li> </ul>"},{"location":"walkthrough/rules/sdgeAR_reformat/#output-guidelines","title":"Output Guidelines","text":"<p>The output file could be used as the input for FICTURE.</p>"},{"location":"walkthrough/rules/sdgeAR_reformat/#parameters","title":"Parameters","text":"<pre><code>downstream:               \n  gene_filter:            \n   keep_gene_type: \"protein_coding,lncRNA\"    # genes to keep\n   rm_gene_regex: \"^Gm\\\\d+|^mt-|^MT-\"         # genes to remove\n</code></pre> <ul> <li> <p>The <code>keep_gene_type</code> Parameter Specifies the types of genes to retain during gene filtering. </p> </li> <li> <p>The <code>rm_gene_regex</code> Parameter Defines the types of genes to be excluded during gene filtering. </p> </li> </ul> <p>Info</p> <p>It is important to note that both parameters also utilizes regular expressions for specifying which genes to remove.</p>"},{"location":"walkthrough/rules/sdgeAR_reformat/#dependencies","title":"Dependencies","text":"<p>Given <code>sdgeAR_reformat</code> requires input from Rule <code>sdge2sdgeAR</code>, Rule <code>sdgeAR_reformat</code> can only execute after <code>sdge2sdgeAR</code> and its prerequisite rules have successfully completed their operations. See an overview of the rule dependencies in the Workflow Structure.</p>"},{"location":"walkthrough/rules/sdgeAR_reformat/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in <code>a07_sdgeAR_reformat.smk</code>.</p>"},{"location":"walkthrough/rules/sdgeAR_segment/","title":"Rule <code>sdgeAR_segment</code>:","text":""},{"location":"walkthrough/rules/sdgeAR_segment/#purpose","title":"Purpose","text":"<p>The <code>sdgeAR_segment</code> transforms pixel-based SGEs into hexagon-based SGEs by aggregating pixels into hexagonal grids, the size of which is determined by the user.</p>"},{"location":"walkthrough/rules/sdgeAR_segment/#input-files","title":"Input Files","text":"<ul> <li>FICTURE-compatible SGE and the Meta File for Coordinates The necessary input files include a FICTURE-compatible SGE and its corresponding meta file for X Y coordinates. The FICTURE-compatible SGE is produced by the Rule <code>sdgeAR_reformat</code>. The meta file for coordinates can be generated by <code>sdge2sdgeAR</code> or can be manually created.</li> </ul>"},{"location":"walkthrough/rules/sdgeAR_segment/#output-files","title":"Output Files","text":"<p>The rule generates the following output in the specified directory path: <pre><code>&lt;output_directory&gt;/analysis/&lt;run_id&gt;/&lt;unit_id&gt;/segment/\n</code></pre></p>"},{"location":"walkthrough/rules/sdgeAR_segment/#1-hexagon-based-sge","title":"(1) Hexagon-based SGE","text":"<p>Description: This output consists of an SGE formatted by segmenting pixels into hexagonal units. The size of the hexagons is defined by the user. The format of this SGE conforms to the 10x genome standard.</p> <p>File Naming Convention:  <pre><code>&lt;unit_id&gt;.merged.matrix.tsv.gz\n</code></pre></p> <p>File Format:</p> <p>Warning</p> <p>The <code>barcodes.tsv.gz</code> and <code>features.tsv.gz</code> in the hexagon-based SGE is a bit different from those in the pixel-based SGE illustrated in Rule <code>dge2sdge</code>.</p> <ul> <li> <p><code>barcodes.tsv.gz</code>: <pre><code>1_0.0_3059096.64_1620124.64_11\n2_0.0_3727394.36_3208789.64_11\n3_0.0_4140308.56_2215259.44_17\n</code></pre></p> <ul> <li>Column 1: hexagon IDs</li> </ul> </li> <li> <p><code>features.tsv.gz</code>: <pre><code>ENSMUSG00000029368  Alb     Gene Expression\nENSMUSG00000002985  Apoe      Gene Expression\nENSMUSG00000078672  Mup20   Gene Expression\n</code></pre></p> <ul> <li>Column 1: Gene Ensemble ID</li> <li>Column 2: Gene symbol</li> <li>Column 3: Gene info</li> </ul> </li> <li> <p><code>matrix.mtx.gz</code>: <pre><code>%%MatrixMarket matrix coordinate integer general\n%\n33951 79179 11120678\n826 1 1\n13 1 1\n3935 1 1\n</code></pre></p> <ul> <li><code>Header</code>: Initial lines form the header, declaring the matrix's adherence to the Market Matrix (MTX) format, outlining its traits. This may include comments (lines beginning with <code>%</code>) for extra metadata, all marked by a \u201c%\u201d.</li> <li><code>Dimensions</code>: Following the header, the first line details the matrix dimensions: the count of rows (features), columns (barcodes), and non-zero entries.</li> <li><code>Data Entries</code>: Post-dimensions, subsequent lines enumerate non-zero entries in seven columns: row index (feature index), column index (barcode index), and five values (expression levels) corresponds to Gene, GeneFull, Spliced, Unspliced, and Ambiguous.</li> </ul> </li> </ul>"},{"location":"walkthrough/rules/sdgeAR_segment/#output-guidelines","title":"Output Guidelines","text":"<p>The output file can serve as input for tools that require SGE in the 10x genome format.</p>"},{"location":"walkthrough/rules/sdgeAR_segment/#parameters","title":"Parameters","text":"<pre><code>downstream:\n  segment:                 \n    precision: 2\n    min_pixel_per_unit: 10\n    mu_scale: 1000        \n    char:                \n      - solofeature: gn    \n        trainwidth: 24     \n        segmentmove: 1     \n</code></pre> <ul> <li> <p>The <code>precision</code> Parameter Specifies the number of digits to store spatial location (in um, 0 for integer)</p> </li> <li> <p>The <code>min_pixel_per_unit</code> Parameter A minimum UMI count of output hexagons</p> </li> <li> <p>The <code>mu_scale</code> Parameter Specify coordinate to um translate for hexagon. By default, we consider the spatial digital gene expression matrix (SGE) is in nano meter.</p> </li> <li> <p>The <code>char</code> Parameter Specify the characteristics for the hexagons, including the genomic feature to create hexagon (<code>solo feature</code>), the size for a hexagonal grid (<code>trainwidth</code>), and whether the SGE is based on overlapping hexagons or non-overlapping hexagon (<code>segmentmove</code>). When <code>segmentmove</code> is 1, non-overlapping hexagon-based SGE will be created.</p> </li> </ul>"},{"location":"walkthrough/rules/sdgeAR_segment/#dependencies","title":"Dependencies","text":"<p>Rule <code>sdgeAR_segment</code> requires input from Rules <code>sdgeAR_reformat</code> and <code>sdge2sdgeAR</code>. Thus, Rule <code>sdgeAR_segment</code> can only execute after <code>sdgeAR_reformat</code> and <code>sdge2sdgeAR</code> and their prerequisite rules when applicable have successfully completed their operations. See an overview of the rule dependencies in the Workflow Structure.</p>"},{"location":"walkthrough/rules/sdgeAR_segment/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in <code>a08_sdgeAR_segment.smk</code>.</p>"},{"location":"walkthrough/rules/smatch/","title":"Rule <code>smatch</code>","text":""},{"location":"walkthrough/rules/smatch/#purpose","title":"Purpose","text":"<p>The <code>smatch</code> rule examines that for a pair of 2nd-seq FASTQ files, if spatial barcode sequence (HDMI) in read 1 are found in the spatial barcodes map for this chip section. The <code>smatch</code> functions on a per-pair basis for 2nd-seq FASTQ files. This means that for a given chip of interest, which is associated with multiple pairs of 2nd-seq FASTQ files, NovaScope executes <code>smatch</code> for each pair in parallel.</p>"},{"location":"walkthrough/rules/smatch/#input-files","title":"Input Files","text":"<ul> <li> <p>Per-Chip Spatial Barcode Maps &amp; Manifest File Required input files include the spatial barcode map and manifest file for the chip of interest, which are created by the <code>sbcd2chip</code> rule.</p> </li> <li> <p>The 2nd-seq FASTQ files Required input files also include the read 1 file for a pair of 2nd-seq FASTQ files.</p> </li> </ul>"},{"location":"walkthrough/rules/smatch/#output-files","title":"Output Files","text":"<p>The following files are generated for each pair of 2nd-seq FASTQ files in the specified directory path below:</p> <pre><code>&lt;output_directory&gt;/match/&lt;flowcell_id&gt;/&lt;chip_id&gt;/&lt;seq2nd_id&gt;\n</code></pre>"},{"location":"walkthrough/rules/smatch/#1-a-matched-spatial-barcode-file","title":"(1) A Matched Spatial Barcode File","text":"<p>Description: A compressed, tab-delimited file containing spatial barcodes matched to the 2nd-seq reads.</p> <p>File Naming Convention: <code>&lt;seq2st_pair_id&gt;.R1.match.sorted.uniq.tsv.gz</code></p> <p>File Format:</p> <pre><code>AAAAAAAATAGTTCTGCTAGCTGGTAAGCTA  1  1  7124822  2910007  1  6\nAAAAAAAGTGATCAGAGGTGATATTATGCTT  1  1  7382402  2721048  1  6\nAAAAAAAGTTCGCACTATACGAACAGGGATC  1  1  8634969  2843056  1  1\n</code></pre> <ul> <li>Column 1: Spatial barcode sequence</li> <li>Column 2: Lane ID, which is defined as <code>1</code>.</li> <li>Column 3: Tile ID, which is defined as <code>1</code>.</li> <li>Column 4: X-coordinate within the chip (global X-coordinate).</li> <li>Column 5: Y-coordinate within the chip (global Y-coordinate).</li> <li>Column 6: Number of bases that do not match the expected pattern defined by the format (0 is a perfect match).</li> <li>Column 7: Number of occurrences in the 2nd-seq FASTQ read 1 file.</li> </ul>"},{"location":"walkthrough/rules/smatch/#2-a-smatch-image","title":"(2) A \"smatch\" Image","text":"<p>Description: An image depicting the spatial coordinate distribution of the matched barcodes.</p> <p>File Naming Convention: <code>&lt;seq2st_pair_id&gt;.R1.match.png</code></p> <p>File Visualization:</p>"},{"location":"walkthrough/rules/smatch/#3-an-overall-summary-of-matching-results","title":"(3) An Overall Summary of Matching Results","text":"<p>Description: A summary of the count and fraction of 2nd-seq reads based on the matching results.</p> <p>File Naming Convention: <code>&lt;seq2st_pair_id&gt;.R1.summary.tsv</code></p> <p>File Format:</p> <pre><code>Type        Reads      Fraction\nTotal       163383382  1.00000\nMiss        80020087   0.48977\nMatch       83363295   0.51023\nUnique      17641021   0.10797\nDup(Exact)  65722274   0.40226\n</code></pre> <ul> <li><code>Type</code> : The type of statistics, including the following values:<ul> <li><code>Total</code> : All reads in the 2nd-seq FASTQ file.</li> <li><code>Miss</code> : Reads that do not contain matching spatial barcodes.</li> <li><code>Match</code> : Reads that match with a spatial barcode.</li> <li><code>Unique</code> : Unique spatial barcodes that has matches.</li> <li><code>Dup(Exact)</code> : Duplicate barcodes calculated as Match - Unique.</li> </ul> </li> <li><code>Reads</code> : The number of reads or barcodes that match the type.</li> <li><code>Fraction</code> : The fraction of the reads (among all reads) that match the type.</li> </ul>"},{"location":"walkthrough/rules/smatch/#4-a-summary-of-matched-and-unique-barcodes","title":"(4) A Summary of Matched and Unique Barcodes","text":"<p>Description: A tab-delimited file containing the number of matched and unique spatial barcodes.</p> <p>File Naming Convention: <code>&lt;seq2st_pair_id&gt;.R1.counts.tsv</code></p> <p>File Format:</p> <pre><code>id   filepath                 barcodes   matches   unique\n1_1  1_1.sbcds.sorted.tsv.gz  175135683  83363295  17641021\n</code></pre> <ul> <li><code>id</code>: The <code>id</code> is composed of <code>&lt;lane_id&gt;_&lt;tile_id&gt;</code>. Given only one spatial barcode map is created for a chip, the ID is designed as <code>1_1</code>.</li> <li><code>filepath</code>: The file name is the corresponding spatial barcode map.</li> <li><code>barcodes</code>: The number of spatial barcodes in the chip.</li> <li><code>matches</code>: The number of barcodes match to the expected pattern.</li> <li><code>unique</code>: The number of unique barcodes match to the expected pattern.</li> </ul>"},{"location":"walkthrough/rules/smatch/#output-guidelines","title":"Output Guidelines","text":"<p>Suggested review steps:</p> <ol> <li>Examine summary files to verify that the matched barcode rate isn't low rate, such as &lt; 5%. A low matching rate might indicate a possible sample swap.</li> <li>Inspect the \"smatch\" image for an even distribution of matched barcodes across the tissue area. An unexpected pattern may suggest issues with experimental procedures, like unsuccessful tissue permeabilization.</li> </ol>"},{"location":"walkthrough/rules/smatch/#parameters","title":"Parameters","text":"<p>The following parameter in the job configuration file will be applied in this rule.</p> <pre><code>upstream:\n  smatch:                  \n    skip_sbcd: 1            \n    match_len: 27           \n  visualization:\n    drawxy:\n      coord_per_pixel: 1000\n      intensity_per_obs: 50\n      icol_x: 3\n      icol_y:\n</code></pre> <ul> <li> <p>The <code>smatch</code> Parameters</p> <p>Parameters for <code>smatch</code>, used to pass values to the <code>match-sbcds</code> function in spatula. Below, for each parameter, the corresponding parameter in spatula, description, and the default value in NovaScope are provided.</p> Parameter <code>spatula</code> parameter Description Default Value <code>skip_sbcd</code> <code>--skip-sbcd</code> The number of initial bases to omit from the read.* 1 <code>match_len</code> <code>--match-len</code> The length of the spatial barcode to be considered as a perfectmatch. 27 <ul> <li><code>skip_sbcd</code>: This is useful if the 1st-seq spatial barcode lacks sufficient bases. When it is absent, NovaScope determines <code>skip_sbcd</code> following the <code>format</code> of <code>fastq2sbcd</code>: 1 for DraI31 and 0 for DraI32.</li> </ul> </li> <li> <p>The <code>visualization</code> Parameters</p> <p>Parameters for the <code>visualization</code> step, provided to the <code>draw-xy</code> function in spatula.</p> Parameter <code>spatula</code> parameter Description Default Value <code>coord_per_pixel</code> <code>--coord-per-pixel</code> Coordinates per pixel, as a divisor of input coordinate. 1000 <code>intensity_per_obs</code> <code>--intensity-per-obs</code> Intensity of points per pixel, max 255. 50 <code>icol_x</code> <code>--icol-x</code> (0-based) index of X coordinate in input TSV. 3 <code>icol_y</code> <code>--icol-y</code> (0-based) index of Y coordinate in input TSV. 4 </li> </ul>"},{"location":"walkthrough/rules/smatch/#dependencies","title":"Dependencies","text":"<p>The <code>sbcd2chip</code> requires the successful execution of <code>sbcd2chip</code> to operate as intended. An overview of the rule dependencies are provided in the Workflow Structure.</p>"},{"location":"walkthrough/rules/smatch/#code-snippet","title":"Code Snippet","text":"<p>The code for this rule is provided in a03_smatch.smk</p>"}]}